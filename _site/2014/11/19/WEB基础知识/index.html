<!DOCTYPE html><html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /><title>web基础知识cookie,session,filter,listener &mdash; ssgao</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/aouoxx/aouoxx.github.io@master/assets/vendor/primer-css/css/primer.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/aouoxx/aouoxx.github.io@master/assets/css/components/collection.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/aouoxx/aouoxx.github.io@master/assets/css/components/repo-card.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/aouoxx/aouoxx.github.io@master/assets/css/sections/repo-list.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/aouoxx/aouoxx.github.io@master/assets/css/components/boxed-group.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/aouoxx/aouoxx.github.io@master/assets/css/globals/common.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/aouoxx/aouoxx.github.io@master/assets/css/globals/responsive.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/aouoxx/aouoxx.github.io@master/assets/css/posts/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/aouoxx/aouoxx.github.io@master/assets/vendor/octicons/octicons/octicons.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mzlogin/rouge-themes@master/dist/github.css"><link rel="canonical" href="http://localhost:4000/2014/11/19/WEB%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"><link rel="alternate" type="application/atom+xml" title="ssgao" href="http://localhost:4000/feed.xml"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/aouoxx/aouoxx.github.io@master/favicon.ico"><meta property="og:title" content="web基础知识cookie,session,filter,listener"><meta name="keywords" content="web, cookie, seession"><meta name="og:keywords" content="web, cookie, seession"><meta name="description" content=""><meta name="og:description" content=""><meta property="og:url" content="http://localhost:4000/2014/11/19/WEB%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"><meta property="og:site_name" content="ssgao"><meta property="og:type" content="article"><meta property="og:locale" content="zh_CN" /><meta property="article:published_time" content="2014-11-19"> <script src="https://cdn.jsdelivr.net/gh/aouoxx/aouoxx.github.io@master/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="https://cdn.jsdelivr.net/gh/aouoxx/aouoxx.github.io@master/assets/js/jquery-ui.js"></script> <script src="https://cdn.jsdelivr.net/gh/aouoxx/aouoxx.github.io@master/assets/js/main.js"></script></head><body class="" data-mz=""><header class="site-header"><div class="container"><h1><a href="http://localhost:4000/" title="ssgao"><span class="octicon octicon-mark-github"></span> ssgao</a></h1><button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button><nav class="site-header-nav" role="navigation"> <a href="http://localhost:4000/" class=" site-header-nav-item" target="" title="首页">首页</a> <a href="http://localhost:4000/categories/" class=" site-header-nav-item" target="" title="分类">分类</a> <a href="http://localhost:4000/links/" class=" site-header-nav-item" target="" title="链接">链接</a> <a href="http://localhost:4000/about/" class=" site-header-nav-item" target="" title="关于">关于</a></nav></div></header><section class="collection-head small geopattern" data-pattern-id="web基础知识cookie,s"><div class="container"><div class="columns"><div class="column three-fourths"><div class="collection-title"><h1 class="collection-header">web基础知识cookie,session,filter,listener</h1><div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2014/11/19 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="http://localhost:4000/categories/#web" title="web">web</a> </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> 共 37105 字，约 107 分钟 </span></div></div></div><div class="column one-fourth mobile-hidden"><div class="collection-title"> <img style="height:72px;width:72px" src="https://cdn.jsdelivr.net/gh/aouoxx/aouoxx.github.io@master/assets/images/qrcode.jpg" alt="ssgao断点" /></div></div></div></div></section><section class="container content"><div class="columns"><div class="column three-fourths" ><article class="article-content markdown-body"><meta name="referrer" content="no-referrer" /><h3 id="cookie-的使用">cookie 的使用</h3><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">会话的概念</span>
<span class="n">会话简单理解为</span><span class="err">：</span><span class="n">用户开一个浏览器</span><span class="err">，</span><span class="n">点击多个超链接</span><span class="err">，</span><span class="n">访问服务器多个web资源</span><span class="err">，</span><span class="n">整个过程称之为一个回话</span>

<span class="n">保存回话数据的两种技术</span><span class="err">：</span>
<span class="n">cookie</span> <span class="n">客户端技术</span>
	<span class="n">程序把每个用户的数据以cookie的形式写给用户各自的浏览器</span><span class="err">。</span>
    <span class="n">当用户使用浏览器再去访问服务器中的web资源时</span><span class="err">，</span><span class="n">就会带着各自的数据去</span><span class="err">。</span>
    <span class="n">这样web资源处理的就是用户各自的数据了</span>
<span class="nc">Session</span>  <span class="nc">Session是服务器端技术</span><span class="err">，</span>
    <span class="n">利用这个技术</span><span class="err">，</span><span class="n">服务器在运行时</span><span class="err">，</span><span class="n">可以为每个用户浏览器创建一个其独享的session对象</span><span class="err">，</span>
    <span class="n">由于session为用户浏览器独享</span><span class="err">，</span><span class="n">所以用户在访问服务器的web资源时</span><span class="err">，</span><span class="n">可以把各自的数据放在各自的Session</span>
<span class="n">中</span><span class="err">，</span><span class="n">当用户再去访问服务器中的其他web资源时</span><span class="err">，</span><span class="n">其他web资源再从用户各自的Session中取出数据为用户服务</span>
</code></pre></div></div><p>​</p><p>​</p><p>​</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nc">Cookie</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">String</span>   <span class="n">value</span><span class="o">)</span>
    <span class="n">实例化Cookie对象</span><span class="err">，</span><span class="n">传入cooke名称和cookie的值</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span>
    <span class="n">取得Cookie的名字</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getValue</span><span class="o">()</span>
    <span class="n">取得Cookie的值</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setValue</span><span class="o">(</span><span class="nc">String</span> <span class="n">newValue</span><span class="o">)</span>
    <span class="n">设置Cookie的值</span>
<span class="kd">public</span> <span class="kt">int</span> <span class="nf">getMaxAge</span><span class="o">()</span>
    <span class="n">获取Cookies的有效期</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getPath</span><span class="o">()</span>
    <span class="n">获取cookie的有效路径</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDomain</span><span class="o">(</span><span class="nc">String</span> <span class="n">pattern</span><span class="o">)</span>
    <span class="n">设置cookie的有效域</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getDomain</span><span class="o">()</span>
    <span class="n">获取cookie的有效域</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPath</span><span class="o">(</span><span class="nc">String</span> <span class="n">uri</span><span class="o">)</span>
    <span class="n">设置cookie的有效路径</span><span class="err">，</span><span class="n">比如把cookie的有效路径设置为</span><span class="s">"/xdp"</span><span class="err">，</span><span class="n">那么浏览器访问</span><span class="s">"xdp"</span><span class="n">目录下的web资源时</span><span class="err">，</span><span class="n">都会带上cookie</span><span class="err">，</span>
    <span class="n">再比如把cookie的有效路径设置为</span><span class="s">"/xdp/gacl"</span><span class="err">，</span><span class="n">那么浏览器只有在访问</span><span class="s">"xdp"</span><span class="n">目录下的</span><span class="s">"gacl"</span><span class="n">这个目录里面的web资源时才会带上cookie一起访问</span><span class="err">，</span><span class="n">而当访问</span><span class="s">"xdp"</span><span class="n">目录下的web资源时</span><span class="err">，</span><span class="n">浏览器是不带cookie的</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMaxAge</span><span class="o">(</span><span class="kt">int</span> <span class="n">expiry</span><span class="o">)</span>
    <span class="n">设置Cookie的最大保存时间</span><span class="err">，</span><span class="n">即cookie的有效期</span><span class="err">，</span><span class="n">当服务器给浏览器回送一个cookie时</span><span class="err">，</span><span class="n">如果在服务器端没有调用setMaxAge方法设置cookie的有效期</span><span class="err">，</span><span class="n">那么cookie的有效期只在一次会话过程中有效</span><span class="err">，</span>
<span class="n">用户开一个浏览器</span><span class="err">，</span><span class="n">点击多个超链接</span><span class="err">，</span><span class="n">访问服务器多个web资源</span><span class="err">，</span><span class="n">然后关闭浏览器</span><span class="err">，</span><span class="n">整个过程称之为一次会话</span><span class="err">，</span><span class="n">当用户关闭浏览器</span><span class="err">，</span><span class="n">会话就结束了</span><span class="err">，</span><span class="n">此时cookie就会失效</span><span class="err">，</span>
<span class="n">如果在服务器端使用setMaxAge方法设置了cookie的有效期</span><span class="err">，</span><span class="n">比如设置了30分钟</span><span class="err">，</span><span class="n">那么当服务器把cookie发送给浏览器时</span><span class="err">，</span><span class="n">此时cookie就会在客户端的硬盘上存储30分钟</span><span class="err">，</span><span class="n">在30分钟内</span><span class="err">，</span><span class="n">即使浏览器关了</span><span class="err">，</span>
<span class="n">cookie依然存在</span><span class="err">，</span><span class="n">在30分钟内</span><span class="err">，</span><span class="n">打开浏览器访问服务器时</span><span class="err">，</span><span class="n">浏览器都会把cookie一起带上</span><span class="err">，</span><span class="n">这样就可以在服务器端获取到客户端浏览器传递过来的cookie里面的信息了</span><span class="err">，</span><span class="n">这就是cookie设置maxAge和不设置maxAge的区别</span><span class="err">，</span>
<span class="n">不设置maxAge</span><span class="err">，</span><span class="n">那么cookie就只在一次会话中有效</span><span class="err">，</span><span class="n">一旦用户关闭了浏览器</span><span class="err">，</span><span class="n">那么cookie就没有了</span><span class="err">，</span><span class="n">那么浏览器是怎么做到这一点的呢</span><span class="err">，</span><span class="n">我们启动一个浏览器</span><span class="err">，</span><span class="n">就相当于启动一个应用程序</span><span class="err">，</span>
<span class="n">而服务器回送的cookie首先是存在浏览器的缓存中的</span><span class="err">，</span><span class="n">当浏览器关闭时</span><span class="err">，</span><span class="n">浏览器的缓存自然就没有了</span><span class="err">，</span><span class="n">所以存储在缓存中的cookie自然就被清掉了</span><span class="err">，</span><span class="n">而如果设置了cookie的有效期</span><span class="err">，</span><span class="n">那么浏览器在关闭时</span><span class="err">，</span>
<span class="n">就会把缓存中的cookie写到硬盘上存储起来</span><span class="err">，</span><span class="n">这样cookie就能够一直存在了</span><span class="err">。</span>

</code></pre></div></div><p>​</p><p>​</p><blockquote><p><em>response 接口也定义了一个 addCookie 方法，它用于在其响应头中增加一个响应的 Set-Cookie 头字段。同样，request 接口中也定义了一个 getCookies 方法，它用于获取客户端提交的 Cookie</em>​</p></blockquote><p>​</p><h4 id="cookie-是什么">cookie 是什么</h4><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">cookie是一小文本信息</span><span class="err">，</span><span class="n">伴随用户请求在web服务器和浏览器之间传递</span><span class="err">。</span><span class="n">用户每次访问站点的时候</span><span class="err">，</span>
 <span class="n">web应用程序都可以读取cookie包含的信息</span><span class="err">，</span><span class="n">在用户请求网站某页面时</span><span class="err">，</span><span class="n">应用程序不仅返回请求页面</span><span class="err">，</span><span class="n">同时也返回一个包含日期和时间的cookie</span><span class="err">。</span>
 <span class="n">该cookie可能会保存在客户端的cookie文件夹中</span><span class="err">。</span>
</code></pre></div></div><h4 id="cookie-的限制">cookie 的限制</h4><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">大多浏览器之处最多可达4096字节</span><span class="o">(</span><span class="n">大约4KB</span><span class="o">)</span><span class="n">cookie</span><span class="err">，</span><span class="n">浏览器还限制一个站点可以在客户端保存的cookie数</span><span class="err">。</span>
<span class="n">大多数浏览器允许每个站点最多放20个cookie</span><span class="err">。</span><span class="n">如果试图保存更多的cookie</span><span class="err">，</span><span class="n">那么</span>
<span class="n">先前保存的cookie将被删除</span><span class="err">。</span><span class="n">还有的浏览器对来自所有站点的cookie总数限制</span><span class="err">，</span><span class="n">这个通常为300个</span>
</code></pre></div></div><p>​</p><h4 id="cookie-的创建">cookie 的创建</h4><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">创建cookie的时候要指定几个值</span><span class="err">，</span><span class="n">首先指定cookie的名字和要保存的值</span><span class="err">。</span><span class="n">可以创建多个cookie</span><span class="err">。</span>
<span class="n">但每个cookie的名字必须唯一</span><span class="err">，</span><span class="n">以便日后取值时识别cookie是按名字存储的</span><span class="err">，</span>
<span class="n">所以如果创建两个名称相同的cookie</span><span class="err">，</span><span class="n">那么最后那个cookie将覆盖前一个</span>
</code></pre></div></div><p>​</p><p>​</p><h4 id="cookie-的持久性">cookie 的持久性</h4><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">如果不设置过期时间</span><span class="err">，</span><span class="n">则表示cookie的声明周期为浏览器的回话期间</span><span class="err">，</span><span class="n">只要关闭浏览器窗口或则回话超时cookie就消失了</span><span class="err">。</span>
<span class="n">这种生命期为浏览器回话期的cookie称为会话cookie会话cookie一般不保存在硬盘上而是保存在内存里</span>
<span class="n">如果设置了过期时间</span><span class="err">，</span><span class="n">浏览器就会把cookie保存到硬盘上</span><span class="err">，</span><span class="n">关闭后再次打开浏览器这些cookie依然有效直到超过设定的过期时间</span><span class="err">。</span>

<span class="n">当用户下次访问的站点的时候</span><span class="err">，</span><span class="n">浏览器会先检查站点的所有cookie</span><span class="err">，</span><span class="n">如果某个cookie已经过期</span><span class="err">，</span><span class="n">浏览器不会把这个cookie随页面请求一起发送给服务器</span><span class="err">，</span><span class="n">而是删除这个已经过期的cookie</span><span class="err">。</span>
<span class="o">(</span><span class="n">程序可以在用户磁盘上</span><span class="err">，</span><span class="n">写入多个cookie</span><span class="o">,</span><span class="n">但每个cookie的过期日期和时间不同</span><span class="o">)</span>
<span class="n">存储在硬盘上的cookie可以在不同的浏览器进程间共享</span><span class="err">，</span><span class="n">比如两个IE窗口</span><span class="err">。</span><span class="n">而对于保存在内存中的cookie</span><span class="err">，</span><span class="n">不同的浏览器有不同的处理方式</span>
</code></pre></div></div><p>​</p><h4 id="cookie-的发送">cookie 的发送</h4><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">创建cookie对象</span> <span class="o">&gt;</span><span class="n">设置最大时效</span> <span class="o">&gt;</span><span class="n">将cookie放入到HTTP响应报头</span>
<span class="n">如果你创建了一个cookie</span><span class="err">，</span><span class="n">并将他发送到浏览器默认情况下它是一个回话级别的cookie</span><span class="err">，</span><span class="n">存储在浏览器的内存中</span><span class="err">，</span><span class="n">用户退出浏览器之后被删除</span><span class="err">。</span>
<span class="n">如果你希望浏览器将该cookie存储在磁盘上</span><span class="err">，</span><span class="n">则需要使用maxAge</span>
<span class="n">并给出一个以秒为单位的时间</span><span class="err">。</span><span class="n">将最大时效设置为0则是命令浏览器删除该cookie</span>

<span class="n">cookie的发送需要使用HttpServeltResponse的addCookie方法</span><span class="err">，</span><span class="n">将cookie插入到一个set</span><span class="o">-</span><span class="n">cookiehttp请求包头中</span><span class="err">，</span>
<span class="n">由于这个方法并不修改任何之前指定的set</span><span class="o">-</span><span class="n">cookie而是创建新的报头</span><span class="err">，</span><span class="n">因此我们将这个方法称为是addCookie</span><span class="err">，</span><span class="n">而非setCookie</span>

</code></pre></div></div><p>​</p><h4 id="cookie-的读取">cookie 的读取</h4><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">通过调用HttpServeltRequest的getCookies方法</span><span class="err">，</span><span class="n">可获得Cookie的对象数组</span><span class="err">，</span><span class="n">对应Http请求中Cookie包头输入的值</span><span class="err">。</span>
<span class="n">对数组进行循环</span><span class="err">，</span><span class="n">调用每个Cookie的getName方法直到找到感兴趣的cookie位置</span>
<span class="nd">@WebServlet</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"cookie"</span> <span class="o">,</span><span class="n">urlPatterns</span><span class="o">=</span><span class="s">"/cookie/*"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CookieDemo</span> <span class="kd">extends</span> <span class="nc">HttpServlet</span> <span class="o">{</span>
<span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doGet</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">resp</span><span class="o">)</span>
                      <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>

              <span class="n">resp</span><span class="o">.</span><span class="na">setCharacterEncoding</span><span class="o">(</span> <span class="s">"UTF-8"</span><span class="o">);</span><span class="c1">//设置服务器以UTF-8编码输出</span>
              <span class="n">resp</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span> <span class="s">"text/html;charset=UTF-8"</span><span class="o">);</span>
              <span class="nc">PrintWriter</span> <span class="n">out</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="na">getWriter</span><span class="o">();</span>
               <span class="c1">//获取浏览器范文服务器时传递过来的cookie数组</span>
              <span class="nc">Cookie</span><span class="o">[]</span> <span class="n">cookies</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">getCookies</span><span class="o">();</span>
               <span class="k">if</span><span class="o">(</span><span class="n">cookies</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
                     <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span> <span class="s">"您上次访问的时间："</span> <span class="o">);</span>
                      <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">cookies</span><span class="o">.</span><span class="na">length</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                           <span class="nc">Cookie</span> <span class="n">cookie</span> <span class="o">=</span> <span class="n">cookies</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
                            <span class="k">if</span><span class="o">(</span><span class="n">cookie</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"lastAccessTime"</span> <span class="o">)){</span>
                                  <span class="nc">Long</span> <span class="n">lastAccessTime</span> <span class="o">=</span> <span class="nc">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">cookie</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
                                  <span class="nc">Date</span> <span class="n">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">(</span><span class="n">lastAccessTime</span><span class="o">);</span>
                                  <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">date</span><span class="o">);</span>
                           <span class="o">}</span>

                     <span class="o">}</span>
              <span class="o">}</span> <span class="k">else</span><span class="o">{</span>
                     <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span> <span class="s">"这是您第一次登陆本站"</span> <span class="o">);</span>
              <span class="o">}</span>

               <span class="c1">//用户访问过之后重新设置用户的访问时间，存储到cookie中，然后发送到客户端浏览器</span>
               <span class="c1">//创建一个cookie,cookie的名字是lastAccessTime</span>
              <span class="nc">Cookie</span> <span class="n">cookie</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Cookie</span><span class="o">(</span><span class="s">"lastAccessTime"</span> <span class="o">,</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()+</span><span class="s">""</span><span class="o">);</span>
              <span class="n">resp</span><span class="o">.</span><span class="na">addCookie</span><span class="o">(</span><span class="n">cookie</span><span class="o">);</span>
       <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doPost</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">resp</span><span class="o">)</span>
                      <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
              <span class="n">doGet</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">resp</span><span class="o">);</span>
       <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p><img src="https://cdn.nlark.com/yuque/0/2021/png/659846/1635722964718-8e06dd3a-9ee4-4beb-96d5-7d53e9d6a24a.png#clientId=ud9602aa2-8379-4&amp;from=paste&amp;height=356&amp;id=u3c11ba48&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=494&amp;originWidth=1167&amp;originalType=binary&amp;ratio=1&amp;size=86943&amp;status=done&amp;style=none&amp;taskId=u4c0d65c6-e170-4dad-b01e-08ea58357ff&amp;width=841.5" alt="image.png" /></p><blockquote><p><em>设置 Cookie 的有效期为一天</em>​ <em>cookie.setMaxAge(24</em>60<em>60)</em>​</p></blockquote><p><img src="https://cdn.nlark.com/yuque/0/2021/png/659846/1635723169961-e35bc47a-0d3e-489c-8c30-bd514204b8f6.png#clientId=ud9602aa2-8379-4&amp;from=paste&amp;height=359&amp;id=u87af344c&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=496&amp;originWidth=1175&amp;originalType=binary&amp;ratio=1&amp;size=110941&amp;status=done&amp;style=none&amp;taskId=u41fd9ee3-a765-4c56-8897-808a2b549ab&amp;width=849.5" alt="image.png" /></p><h4 id="删除-cookie">删除 cookie</h4><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Cookie</span> <span class="n">cookie</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Cookie</span><span class="o">(</span><span class="s">"lastAccessTime"</span><span class="o">,</span><span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()+</span><span class="s">""</span><span class="o">);</span>
<span class="c1">//设置Cookie的有效期为0，命令浏览器删除该Cookie</span>
<span class="n">cookie</span><span class="o">.</span><span class="na">setMaxAge</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
<span class="n">response</span><span class="o">.</span><span class="na">addCookie</span><span class="o">(</span><span class="n">cookie</span><span class="o">);</span>
</code></pre></div></div><p><img src="https://cdn.nlark.com/yuque/0/2021/png/659846/1635723218685-cd0cc110-2ee5-49dd-bfe0-12a9f1da9956.png#clientId=ud9602aa2-8379-4&amp;from=paste&amp;height=283&amp;id=u56dd108c&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=385&amp;originWidth=1175&amp;originalType=binary&amp;ratio=1&amp;size=63948&amp;status=done&amp;style=none&amp;taskId=ue451f94e-adf5-43d6-aba7-692f8179c9d&amp;width=862.5" alt="image.png" /></p><h4 id="cookie-中存取中文">cookie 中存取中文</h4><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">要想在cookie中存储中文</span><span class="err">，</span><span class="n">那么必须使用URLEncoder类里面的encode</span><span class="err">（</span><span class="nc">String</span> <span class="n">s</span><span class="o">,</span> <span class="nc">String</span> <span class="n">enc</span><span class="err">）</span><span class="n">方法进行中文转码</span>
<span class="nc">Cookie</span> <span class="n">cookie</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Cookie</span><span class="o">(</span><span class="s">"userName"</span><span class="o">,</span><span class="nc">URLEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="s">"孤傲苍狼"</span><span class="err">，“</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span><span class="err">”</span><span class="o">));</span>
<span class="n">response</span><span class="o">.</span><span class="na">addCookie</span><span class="o">(</span><span class="n">cookie</span><span class="o">)</span>
<span class="n">在获取cookie中的中文数据时</span><span class="err">，</span><span class="n">在使用URLDecoder类里面的decode</span><span class="o">(</span><span class="nc">String</span> <span class="n">s</span><span class="o">,</span> <span class="nc">String</span> <span class="n">enc</span><span class="o">)</span><span class="n">进行解码</span><span class="err">，</span><span class="n">例如</span><span class="err">：</span>
<span class="nc">URLDecoder</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="n">cookies</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">getValue</span><span class="o">(),</span><span class="err">'</span><span class="no">UTF</span><span class="o">-</span><span class="mi">8</span><span class="err">'</span><span class="o">);</span>
</code></pre></div></div><h4 id="cookie-的其他注意">cookie 的其他注意</h4><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Cookie的注意细节</span>
<span class="mi">1</span><span class="err">）</span><span class="n">一个Cookie只能标识一种信息</span><span class="err">，</span><span class="n">它至少含有一个标识该信息的名称NAME和设置值</span><span class="err">（</span><span class="no">VALUE</span><span class="err">）</span>
<span class="mi">2</span><span class="err">）</span><span class="n">一个web站点可以给WEB浏览器发送多个Cookie</span><span class="err">，</span><span class="n">一个WEB浏览器也可以存储多个WEN站点提供的Cookie</span>
<span class="mi">3</span><span class="err">）</span><span class="n">浏览器一般只允许存放300个Cookie</span><span class="err">，</span><span class="n">每个站点最多存放20个Cookie</span><span class="err">，</span><span class="n">每个Cookie的大小限制为4KB</span>
<span class="mi">4</span><span class="err">）</span><span class="n">如果创建了一个cookie</span><span class="err">，</span><span class="n">并将他发送到浏览器</span><span class="err">，</span><span class="n">默认情况下它是一个会话级别的cookie</span><span class="err">（</span><span class="n">即存储在浏览器的内存中</span><span class="err">），</span><span class="n">用户退出浏览器之后即被删除</span><span class="err">。</span>
<span class="n">若希望浏览器将该cookie存储在磁盘上</span><span class="err">，</span><span class="n">则需要使用maxAge</span><span class="err">，</span><span class="n">并给出一个以秒为单位的时间</span><span class="err">。</span><span class="n">将最大时效设为0则是命令浏览器删除该cookie</span><span class="err">。</span>

</code></pre></div></div><h3 id="session-的介绍">session 的介绍</h3><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">WEB开发中</span><span class="err">，</span><span class="n">服务器可以为每个用户浏览器创建一个会话对象</span><span class="o">(</span><span class="nc">Session</span><span class="o">)</span><span class="n">对象</span><span class="err">，</span><span class="n">注意一个浏览器独占一个session对象</span><span class="err">。</span>
<span class="n">因此在需要保存用户数据是</span><span class="err">，</span><span class="n">服务器程序可以把用户数据写到用户浏览器</span>
<span class="n">独占的Session中</span><span class="err">，</span><span class="n">当用户使用浏览器访问其他程序时</span><span class="err">，</span><span class="n">其他程序可以从用户的session中取出该用户的数据</span><span class="err">，</span><span class="n">为用户服务</span>

</code></pre></div></div><h4 id="session-的特点">session 的特点</h4><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Cookie是把用户数据写给用户的浏览器</span>
<span class="nc">Session技术是把用户的数据数据写到用户独占的session</span>
<span class="nc">Session对象有服务器创建</span><span class="err">，</span><span class="n">可以调用request对象的getSession方法得到Session对象</span><span class="err">。</span>
</code></pre></div></div><h4 id="httpsession-的常见问题">httpsession 的常见问题</h4><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Session的创建的时间</span>
<span class="n">一个常见的误解是以为session在有客户端访问的时候就被创建了</span><span class="err">，</span>
 <span class="n">实际上是直到某个server端程序调用HttpServletRequest</span><span class="o">.</span><span class="na">getSession</span><span class="err">（</span><span class="kc">true</span><span class="err">）</span><span class="n">这样的语句才被创建</span><span class="err">，</span><span class="n">注意如果JSP没有显示的使用</span>
<span class="o">&lt;%</span> <span class="nd">@page</span> <span class="n">session</span><span class="o">=</span><span class="s">"false"</span> <span class="o">%&gt;</span><span class="n">关闭session</span><span class="err">，</span>
  <span class="n">则JSP文件在编译成Servlet时</span><span class="err">，</span><span class="n">将会自动加上这样一条语句</span>
    <span class="nc">HttpSession</span> <span class="n">session</span><span class="o">=</span><span class="nc">HttpSessionRequest</span><span class="o">.</span><span class="na">getSession</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
<span class="n">这也是JSP中隐含的session对象的来历</span>
<span class="n">由于session会消耗内存资源</span><span class="err">，</span><span class="n">因此</span><span class="err">，</span><span class="n">如果不打算使用session</span><span class="err">，</span><span class="n">应该在所有的JSP中关闭它</span>

</code></pre></div></div><h4 id="session-何时删除">session 何时删除</h4><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">调用程序HttpSession</span><span class="o">.</span><span class="na">invalidate</span><span class="o">()</span>
<span class="n">距离上一次收到客户端发送的session</span> <span class="n">id时间间隔超过了session的超时设置</span>
<span class="n">服务器进程被停止</span><span class="o">(</span><span class="n">非持久session</span><span class="o">)</span>

<span class="n">如何做到在浏览器关闭的时候删除session严格的讲</span><span class="err">，</span><span class="n">做不到这一点</span><span class="err">。</span>
<span class="n">可以做一点努力的办法是在所有的客户端页面里面使用javascript代码</span>
<span class="n">window</span><span class="o">.</span><span class="na">onclose</span><span class="err">（）</span><span class="n">来监视浏览器的动作</span><span class="err">，</span><span class="n">然后向服务器发送一个请求来删除session</span><span class="err">。</span>
<span class="n">但是对于浏览器崩溃和强行杀死进程这些非常规的手段无能为力</span>
</code></pre></div></div><h5 id="httpsessionlistener-是怎么回事">httpsessionlistener 是怎么回事</h5><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">可以创建这样的Listenter去监控session的创建和销毁事件</span><span class="err">，</span><span class="n">使得在发生事件时可以做一些相应的工作</span><span class="err">。</span>
<span class="n">注意是session的创建和销毁动作触发listener</span><span class="err">，</span><span class="n">而不是相反</span><span class="err">，</span><span class="n">类似的与HttpSession相关的Listener还有</span>
<span class="nc">HttpSessionBindingListener</span><span class="o">,</span><span class="nc">HttpSessionActivationListener</span><span class="o">,</span><span class="n">和HttpSessionAttiributeListener</span>

    <span class="nc">HttpSessionListener</span>
        <span class="n">在session创建和销毁时用</span><span class="o">(</span><span class="nc">StandardSession</span><span class="o">.</span><span class="na">setId</span><span class="o">(),</span><span class="nc">StandardSession</span><span class="o">.</span><span class="na">expire</span><span class="o">())</span>
    <span class="nc">HttpSessionActivationListener</span>
        <span class="n">在session钝化和反钝化时用</span><span class="o">(</span><span class="nc">StandardSession</span><span class="o">.</span><span class="na">doUnload</span><span class="o">(),</span><span class="nc">StandardSession</span><span class="o">.</span><span class="na">doload</span><span class="o">())</span>
    <span class="nc">HttpSessionAttributeListener</span>
        <span class="n">在session的attributes属性发生变化时</span>
</code></pre></div></div><h5 id="存放-session-中对象必须是可序列化么">存放 session 中对象必须是可序列化么</h5><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">不是必须的</span><span class="err">。</span>
<span class="n">要求对象序列化只是为了session能够在集群中被复制或者能够持久保存或必要时server能够展示把session交换出内存</span><span class="err">，</span>

</code></pre></div></div><h5 id="session-存放在哪里">session 存放在哪里</h5><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">服务器端的内存中</span><span class="err">。</span><span class="n">不过session可以通过特殊的方式做持久化管理</span><span class="o">.</span>
</code></pre></div></div><h5 id="session-的-id-是从哪里来的">session 的 ID 是从哪里来的</h5><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">essionID是如何使用的</span><span class="err">，</span><span class="n">当客户端第一次请求session对象时候</span><span class="err">，</span><span class="n">服务器会为客户端创建一个session</span><span class="err">，</span><span class="n">并将通过特殊的算法算出一个session的ID</span><span class="err">，</span><span class="n">用来标识该session对象</span>
<span class="n">当浏览器下次</span><span class="o">(</span><span class="n">session继续有效时</span><span class="o">)</span><span class="n">请求别的资源的时候浏览器会偷偷将sessionID放置到请求头中</span><span class="err">，</span>
	<span class="n">服务器接受到请求后就得到该请求的sessionID</span><span class="o">,</span><span class="n">服务器找到该id的session返回给请求servelt使用</span><span class="err">。</span>
<span class="n">一个回话只能有一个session管理</span><span class="err">，</span><span class="n">对session来说是只认id不认人</span>

<span class="n">session因为请求</span><span class="err">（</span><span class="n">request对象</span><span class="err">）</span><span class="n">而产生</span><span class="o">,</span><span class="n">同一个会话中多个request共享了一session对象</span><span class="o">,</span><span class="n">可以直接从请求中获取到session对象</span><span class="err">。</span>
<span class="n">session的创建和使用总在服务端</span><span class="err">，</span><span class="n">而浏览器从来都没有得到过session对象</span><span class="err">。</span>
<span class="n">但浏览器可以请求Servlet</span><span class="o">(</span><span class="n">jsp也是Servlet</span><span class="o">)</span><span class="n">来获取session信息</span><span class="err">。</span>
<span class="n">客户端浏览器真正紧紧拿到的是session</span> <span class="no">ID</span><span class="o">,</span><span class="n">而对于这个浏览器操作的人来说是不可见的</span><span class="err">，</span><span class="n">并且用户也无需关心自己处于哪个回话中</span><span class="o">.</span>
</code></pre></div></div><h4 id="session-的生成">session 的生成</h4><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Session对象的创建一般是源于这样语句</span>
<span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>  <span class="n">或者</span> <span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span><span class="n">如果不在乎服务器压力可能多那么一点点</span>
<span class="n">在Tomcat的实现中</span><span class="err">，</span><span class="n">这个request是org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">catalina</span><span class="o">,</span><span class="n">connector</span><span class="o">.</span><span class="na">Request类的包装类</span>

<span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">catalina</span><span class="o">.</span><span class="na">connector</span><span class="o">.</span><span class="na">RequestFacade的对象</span><span class="err">，</span><span class="n">它的两个getSession的方法如下</span><span class="err">：</span>

<span class="kd">public</span> <span class="nc">HttpSession</span> <span class="nf">getSession</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">create</span><span class="o">){</span>
    <span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">.</span><span class="na">request</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">(</span><span class="n">sm</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"requestFacade.nullRequest"</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="k">if</span> <span class="o">(</span><span class="nc">SecurityUtil</span><span class="o">.</span><span class="na">isPackageProtectionEnabled</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="nc">HttpSession</span><span class="o">)</span><span class="nc">AccessController</span><span class="o">.</span><span class="na">doPrivileged</span><span class="o">(</span> <span class="k">new</span> <span class="nc">GetSessionPrivilegedAction</span><span class="o">(</span><span class="n">create</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="k">return</span> <span class="k">this</span> <span class="o">.</span><span class="na">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">(</span><span class="n">create</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="nc">HttpSession</span> <span class="nf">getSession</span><span class="o">(){</span>
    <span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">.</span><span class="na">request</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">(</span><span class="n">sm</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"requestFacade.nullRequest"</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="k">return</span> <span class="nf">getSession</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
<span class="o">}</span>

<span class="n">最后进入org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">catalina</span><span class="o">,</span><span class="n">connector</span><span class="o">.</span><span class="na">Request的getSession</span><span class="err">（）</span><span class="n">方法</span>

<span class="kd">public</span> <span class="nc">HttpSession</span> <span class="nf">getSession</span><span class="o">(){</span>
    <span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">doGetSession</span> <span class="o">(</span><span class="kc">true</span> <span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">session</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">null</span> <span class="o">;</span>
       <span class="o">}</span>
    <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="nc">HttpSession</span> <span class="nf">getSession</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">create</span><span class="o">){</span>
    <span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">doGetSession</span> <span class="o">(</span><span class="n">create</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">session</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">null</span> <span class="o">;</span>
    <span class="o">}</span>

    <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span>
<span class="o">}</span>

<span class="n">跳转到doGetSession</span><span class="o">()</span><span class="n">这个方法</span>

<span class="kd">protected</span> <span class="nc">Session</span> <span class="nf">doGetSession</span><span class="o">(</span> <span class="kt">boolean</span> <span class="n">create</span><span class="o">)</span>
         <span class="o">{</span>
          <span class="c1">//没有Context的话直接返回null</span>
           <span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">.</span><span class="na">context</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
             <span class="k">return</span> <span class="kc">null</span> <span class="o">;</span>
           <span class="o">}</span>
           <span class="c1">// 判断Session是否有效</span>
           <span class="k">if</span> <span class="o">((</span><span class="k">this</span> <span class="o">.</span><span class="na">session</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">session</span> <span class="o">.</span><span class="na">isValid</span><span class="o">()))</span> <span class="o">{</span>
             <span class="k">this</span><span class="o">.</span><span class="na">session</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
           <span class="o">}</span>
           <span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">.</span><span class="na">session</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
             <span class="k">return</span> <span class="k">this</span> <span class="o">.</span><span class="na">session</span><span class="o">;</span>
           <span class="o">}</span>

          <span class="c1">// 返回Manager对象，这里是StandardManager类的对象</span>
           <span class="nc">Manager</span> <span class="n">manager</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
           <span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">.</span><span class="na">context</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
             <span class="n">manager</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">context</span><span class="o">.</span><span class="na">getManager</span><span class="o">();</span>
           <span class="o">}</span>
           <span class="k">if</span> <span class="o">(</span><span class="n">manager</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
           <span class="o">{</span>
             <span class="k">return</span> <span class="kc">null</span> <span class="o">;</span>
           <span class="o">}</span>
            <span class="c1">// 判断是否有SessionID</span>
           <span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">.</span><span class="na">requestedSessionId</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">)</span> <span class="o">{</span>
             <span class="k">try</span> <span class="o">{</span>
           <span class="c1">// 在Manager中根据SessionID查找Session</span>
               <span class="k">this</span><span class="o">.</span><span class="na">session</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="na">findSession</span><span class="o">(</span> <span class="k">this</span><span class="o">.</span><span class="na">requestedSessionId</span><span class="o">);</span>
             <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
               <span class="k">this</span><span class="o">.</span><span class="na">session</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
             <span class="o">}</span>
             <span class="k">if</span> <span class="o">((</span><span class="k">this</span> <span class="o">.</span><span class="na">session</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">session</span> <span class="o">.</span><span class="na">isValid</span><span class="o">()))</span> <span class="o">{</span>
               <span class="k">this</span><span class="o">.</span><span class="na">session</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
             <span class="o">}</span>
             <span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">.</span><span class="na">session</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
               <span class="c1">// 更新访问时间</span>
               <span class="k">this</span><span class="o">.</span><span class="na">session</span><span class="o">.</span><span class="na">access</span><span class="o">();</span>
               <span class="k">return</span> <span class="k">this</span> <span class="o">.</span><span class="na">session</span><span class="o">;</span>
             <span class="o">}</span>

           <span class="o">}</span>

          <span class="c1">// 创建新的Session</span>
           <span class="k">if</span> <span class="o">(!</span><span class="n">create</span><span class="o">)</span> <span class="o">{</span>
             <span class="k">return</span> <span class="kc">null</span> <span class="o">;</span>
           <span class="o">}</span>
           <span class="k">if</span> <span class="o">((</span><span class="k">this</span> <span class="o">.</span><span class="na">context</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">response</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">context</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">getEffectiveSessionTrackingModes</span><span class="o">().</span><span class="na">contains</span><span class="o">(</span> <span class="nc">SessionTrackingMode</span><span class="o">.</span><span class="na">COOKIE</span><span class="o">))</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">response</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">isCommitted</span><span class="o">()))</span>
           <span class="o">{</span>
             <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">(</span><span class="n">sm</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"coyoteRequest.sessionCreateCommitted"</span><span class="o">));</span>
           <span class="o">}</span>

          <span class="c1">// 判断是否使用 "/" 作为Session Cookie的存储路径 并且 是否SessionID来自Cookie</span>
           <span class="k">if</span> <span class="o">(((</span><span class="s">"/"</span> <span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">context</span> <span class="o">.</span><span class="na">getSessionCookiePath</span><span class="o">()))</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">isRequestedSessionIdFromCookie</span><span class="o">()))</span> <span class="o">||</span> <span class="o">(</span> <span class="k">this</span><span class="o">.</span><span class="na">requestedSessionSSL</span><span class="o">))</span>
           <span class="o">{</span>
          <span class="c1">// 创建Session</span>
             <span class="k">this</span><span class="o">.</span><span class="na">session</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="na">createSession</span><span class="o">(</span> <span class="n">getRequestedSessionId</span><span class="o">());</span>
           <span class="o">}</span>
           <span class="k">else</span> <span class="k">this</span> <span class="o">.</span><span class="na">session</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="na">createSession</span><span class="o">(</span> <span class="kc">null</span><span class="o">);</span>

           <span class="c1">// 创建一个新的Session Cookies</span>
           <span class="k">if</span> <span class="o">((</span><span class="k">this</span> <span class="o">.</span><span class="na">session</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">getContext</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">getContext</span><span class="o">().</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">getEffectiveSessionTrackingModes</span><span class="o">().</span><span class="na">contains</span><span class="o">(</span> <span class="nc">SessionTrackingMode</span><span class="o">.</span><span class="na">COOKIE</span><span class="o">)))</span>
           <span class="o">{</span>
                <span class="c1">// 配置Session Cookie</span>
             <span class="nc">Cookie</span> <span class="n">cookie</span> <span class="o">=</span> <span class="nc">ApplicationSessionCookieConfig</span><span class="o">.</span><span class="na">createSessionCookie</span><span class="o">(</span> <span class="k">this</span><span class="o">.</span><span class="na">context</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">session</span><span class="o">.</span><span class="na">getIdInternal</span><span class="o">(),</span> <span class="n">isSecure</span><span class="o">());</span>
               <span class="c1">// 在响应中加入Session Cookie</span>
             <span class="k">this</span><span class="o">.</span><span class="na">response</span><span class="o">.</span><span class="na">addSessionCookieInternal</span><span class="o">(</span><span class="n">cookie</span><span class="o">);</span>
           <span class="o">}</span>

           <span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">.</span><span class="na">session</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
             <span class="k">return</span> <span class="kc">null</span> <span class="o">;</span>
           <span class="o">}</span>
          <span class="c1">// 更新访问时间</span>
           <span class="k">this</span><span class="o">.</span><span class="na">session</span><span class="o">.</span><span class="na">access</span><span class="o">();</span>
           <span class="k">return</span> <span class="k">this</span> <span class="o">.</span><span class="na">session</span><span class="o">;</span>
         <span class="o">}</span>

<span class="n">该方法说明了Tomcat创建的大体过程</span><span class="err">，</span>
	<span class="n">首先判断requestSessionId是否存在</span><span class="err">，</span><span class="n">如果存在那么根据这个ID去查找session对象</span><span class="err">。</span>
    <span class="n">如果requestSessionId不存在或者没有取到Session</span><span class="err">，</span><span class="n">并且传递给getSession</span><span class="o">(</span><span class="kt">boolean</span><span class="o">)</span><span class="n">的参数为真</span>
    <span class="n">那么要创建一个新的Session</span><span class="err">，</span><span class="n">并且写给客户端一个Session</span> <span class="nc">Cookie</span>

<span class="n">困惑requestedSessionId的赋值是什么时候赋值的呢</span><span class="err">？</span>

	<span class="n">查看Tomcat的请求处理过程</span><span class="err">，</span><span class="n">请求曾到过这一步</span><span class="err">：</span>
    	<span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">catalina</span><span class="o">.</span><span class="na">connector</span><span class="o">.</span><span class="na">CoyoteAdapter的</span> <span class="n">server</span><span class="o">()</span><span class="n">方法</span><span class="err">。</span>
	<span class="n">方法</span> <span class="n">postParseRequest</span><span class="o">(</span><span class="n">req</span><span class="o">.</span><span class="na">resp</span><span class="o">,</span><span class="n">res</span><span class="o">,</span><span class="n">response</span><span class="o">)</span><span class="err">。</span>
    <span class="n">就是这一步处理了SessionID的获取</span><span class="err">，</span>
    	<span class="n">这个方法调用了</span><span class="err">#</span><span class="n">parseSessionId</span><span class="err">（</span><span class="o">)</span><span class="n">和parseSessionCookiesId</span><span class="o">(</span> <span class="o">)</span><span class="n">这两个方法</span><span class="o">,</span><span class="n">就是它会sessionID进行了提取</span>



</code></pre></div></div><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">parseSessionCookiesId</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">coyote</span><span class="o">.</span><span class="na">Request</span> <span class="n">req</span><span class="o">,</span> <span class="nc">Request</span> <span class="n">request</span><span class="o">)</span>
         <span class="o">{</span>
           <span class="nc">Context</span> <span class="n">context</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Context</span> <span class="o">)</span><span class="n">request</span><span class="o">.</span><span class="na">getMappingData</span><span class="o">().</span><span class="na">context</span><span class="o">;</span>
           <span class="k">if</span> <span class="o">((</span><span class="n">context</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(!</span><span class="n">context</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">getEffectiveSessionTrackingModes</span><span class="o">().</span><span class="na">contains</span><span class="o">(</span><span class="nc">SessionTrackingMode</span> <span class="o">.</span><span class="na">COOKIE</span><span class="o">)))</span>
           <span class="o">{</span>
             <span class="k">return</span><span class="o">;</span>
           <span class="o">}</span>
            <span class="c1">// 返回Cookie</span>
           <span class="nc">Cookies</span> <span class="n">serverCookies</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">getCookies</span><span class="o">();</span>
           <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">serverCookies</span><span class="o">.</span><span class="na">getCookieCount</span><span class="o">();</span>
           <span class="k">if</span> <span class="o">(</span><span class="n">count</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
             <span class="k">return</span><span class="o">;</span>
           <span class="o">}</span>

           <span class="nc">String</span> <span class="n">sessionCookieName</span> <span class="o">=</span> <span class="nc">SessionConfig</span><span class="o">.</span><span class="na">getSessionCookieName</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>

           <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">count</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
             <span class="nc">ServerCookie</span> <span class="n">scookie</span> <span class="o">=</span> <span class="n">serverCookies</span><span class="o">.</span><span class="na">getCookie</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
           <span class="c1">// 判断是否有JSESSIONID这个名字的Cookie</span>
             <span class="k">if</span> <span class="o">(</span><span class="n">scookie</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">sessionCookieName</span><span class="o">))</span>
             <span class="o">{</span>
               <span class="k">if</span> <span class="o">(!</span><span class="n">request</span><span class="o">.</span><span class="na">isRequestedSessionIdFromCookie</span><span class="o">())</span>
               <span class="o">{</span>
                 <span class="n">convertMB</span><span class="o">(</span><span class="n">scookie</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
                 <span class="n">request</span><span class="o">.</span><span class="na">setRequestedSessionId</span><span class="o">(</span><span class="n">scookie</span><span class="o">.</span><span class="na">getValue</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>

                <span class="c1">// 设定Session ID</span>
                 <span class="n">request</span><span class="o">.</span><span class="na">setRequestedSessionCookie</span><span class="o">(</span> <span class="kc">true</span><span class="o">);</span>
                 <span class="n">request</span><span class="o">.</span><span class="na">setRequestedSessionURL</span><span class="o">(</span> <span class="kc">false</span><span class="o">);</span>
                 <span class="c1">// 如果之前在URL中读到了SessionID，那么会覆盖它</span>
                 <span class="k">if</span> <span class="o">(</span><span class="n">log</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
                   <span class="n">log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">" Requested cookie session id is "</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestedSessionId</span><span class="o">());</span>
                 <span class="o">}</span>

               <span class="o">}</span>
               <span class="k">else</span> <span class="nf">if</span> <span class="o">(!</span><span class="n">request</span><span class="o">.</span><span class="na">isRequestedSessionIdValid</span><span class="o">())</span>
               <span class="o">{</span>
                 <span class="n">convertMB</span><span class="o">(</span><span class="n">scookie</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
                 <span class="n">request</span><span class="o">.</span><span class="na">setRequestedSessionId</span><span class="o">(</span><span class="n">scookie</span><span class="o">.</span><span class="na">getValue</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>
               <span class="o">}</span>
             <span class="o">}</span>
           <span class="o">}</span>
         <span class="o">}</span>
</code></pre></div></div><h4 id="session-对象的创建机制">session 对象的创建机制</h4><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">在程序中第一次调用request</span><span class="o">.</span><span class="na">getSession</span><span class="o">()</span><span class="n">方法就会创建一个新的Session</span><span class="err">，</span><span class="n">可以用isNew</span><span class="err">（）</span><span class="n">来判断session是不是新创建的</span>

<span class="c1">//使用request对象的getSession（）获取session，如果session不存在则创建一个</span>
<span class="nc">HttpSession</span> <span class="n">session</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">(</span> <span class="o">);</span>
<span class="c1">//获取sessionId</span>
<span class="nc">String</span> <span class="n">sessionId</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
<span class="c1">//判断session是不是新创建的</span>
<span class="k">if</span><span class="err">（</span><span class="n">session</span><span class="o">.</span><span class="na">isNew</span><span class="o">()</span><span class="err">）</span><span class="o">{</span>
     <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">print</span><span class="o">(</span><span class="s">"session 创建成功，session的id是："</span><span class="o">+</span><span class="n">sessionId</span><span class="o">);</span>
<span class="o">}</span><span class="k">else</span><span class="o">{</span>
     <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">println</span><span class="o">(</span><span class="s">"服务器已经存在session，sesssionId是："</span><span class="o">+</span><span class="n">sessionId</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div><h5 id="session-对象的销毁机制">session 对象的销毁机制</h5><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Session对象默认30分钟没有使用就会自动销毁</span><span class="err">，</span><span class="n">可以在web</span><span class="o">.</span><span class="na">xml文件中手工的配置session的失效时间</span>
 <span class="o">&lt;!--</span> <span class="nl">设置Session的有效时间:</span><span class="n">以分钟为单位</span><span class="o">--&gt;</span>
   <span class="o">&lt;</span><span class="n">session</span><span class="o">-</span><span class="n">config</span><span class="o">&gt;</span>
         <span class="o">&lt;</span><span class="n">session</span><span class="o">-</span><span class="n">timeout</span><span class="o">&gt;</span><span class="mi">15</span><span class="o">&lt;/</span><span class="n">session</span><span class="o">-</span><span class="n">timeout</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">session</span><span class="o">-</span><span class="n">config</span><span class="o">&gt;</span>
<span class="n">当需要程序中手动设置Session失效时</span><span class="err">，</span><span class="n">可以手工调用session</span><span class="o">.</span><span class="na">invalidate方法</span><span class="err">，</span><span class="n">摧毁session</span>
<span class="nc">HttpSession</span> <span class="n">session</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">(</span> <span class="o">);</span>
<span class="c1">//手工调用session.invalidate方法，摧毁session</span>
<span class="n">session</span><span class="o">.</span><span class="na">invalidate</span><span class="o">()</span>

</code></pre></div></div><h5 id="session-的时效时间的三种设置方法">session 的时效时间的三种设置方法</h5><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span><span class="err">）</span><span class="n">web</span> <span class="n">app</span> <span class="n">server</span> <span class="n">中</span><span class="err">，</span><span class="n">如</span> <span class="n">websphere</span> <span class="n">里可以设置超时时间诶30分钟</span>
<span class="mi">2</span><span class="err">）</span><span class="n">在web</span><span class="o">.</span><span class="na">xml中的session</span><span class="o">-</span><span class="n">config配置</span>
     <span class="n">session</span><span class="o">-</span><span class="n">timeout元素</span><span class="err">（</span><span class="no">WEB</span><span class="o">.</span><span class="na">XML文件中的元素</span><span class="err">）</span><span class="n">用来执行默认的回话超时时间间隔</span><span class="err">，</span><span class="n">以分钟为单位</span><span class="err">。</span><span class="n">该元素之必须为整数</span><span class="err">。</span><span class="n">如果session</span><span class="o">-</span><span class="n">timeout</span>
<span class="n">元素的值为0或者负数</span><span class="err">，</span><span class="n">则表示永远不会超时</span><span class="err">。</span>
  <span class="o">&lt;</span><span class="n">session</span><span class="o">-</span><span class="n">config</span><span class="o">&gt;</span>
         <span class="o">&lt;</span><span class="n">session</span><span class="o">-</span><span class="n">timeout</span><span class="o">&gt;</span><span class="mi">15</span><span class="o">&lt;/</span><span class="n">session</span><span class="o">-</span><span class="n">timeout</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">session</span><span class="o">-</span><span class="n">config</span><span class="o">&gt;</span>
<span class="mi">3</span><span class="err">）</span><span class="n">java</span> <span class="n">代码设置</span>
<span class="n">setMaxInactiveInterval设置的是当前回话的失效时间</span><span class="err">，</span><span class="n">不是真个web时间</span><span class="err">，</span><span class="n">单位以秒计算</span><span class="err">。</span><span class="n">如果没有设置的值为0或者为负数</span><span class="err">，</span><span class="n">则表示回话将永远不会关闭</span><span class="err">。</span>
<span class="n">常用设置当前回话使劲</span>
<span class="n">session</span><span class="o">.</span><span class="na">setMaxInactiveInterval</span><span class="o">(</span><span class="mi">30</span><span class="o">*</span><span class="mi">60</span><span class="o">)</span>
</code></pre></div></div><h4 id="session-的使用">session 的使用</h4><h5 id="session-防止表单重复提交">session 防止表单重复提交</h5><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>表单重复提交的场景
1）场景一：在网络延迟的情况下让用户有时间点击多次submit按钮导致表单重复提交 (
可以使用JAVASCRIPT脚本来控制 )
2）场景二：表单提交后用户点击【刷新】按钮导致表单重复提交
3）场景三：用户提交表单后，点击浏览器的【后退】按钮回到表单页面后进行再次提交
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;title&gt;</span>Insert title here<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/Servlet/session/DoFormServlet"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
      用户名： <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"username"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"提交"</span> <span class="na">id=</span><span class="s">"submit"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@WebServlet</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"SESSION"</span> <span class="o">,</span><span class="n">urlPatterns</span><span class="o">=</span><span class="s">"/session/DoFormServlet"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SessionForm</span> <span class="kd">extends</span> <span class="nc">HttpServlet</span> <span class="o">{</span>

        <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doGet</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span>
                    <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
                <span class="c1">//客户端是以UTF-8编码传输数据到服务器端的，所以需要设置服务器端以UTF-8的编码进行接收，否则对于中文数据就会产生乱码</span>
                <span class="n">request</span><span class="o">.</span><span class="na">setCharacterEncoding</span><span class="o">(</span> <span class="s">"UTF-8"</span><span class="o">);</span>
                <span class="nc">String</span> <span class="n">userName</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span> <span class="s">"username"</span><span class="o">);</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="c1">//让当前的线程睡眠3秒钟，模拟网络延迟而导致表单重复提交的现象</span>
                    <span class="nc">Thread</span><span class="o">.</span> <span class="nf">sleep</span><span class="o">(</span><span class="mi">3</span><span class="o">*</span><span class="mi">1000</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"向数据库中插入数据："</span> <span class="o">+</span><span class="n">userName</span><span class="o">);</span>
            <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doPost</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span>
                    <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
               <span class="n">doGet</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
           <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><h6 id="利用-javascript-防止表单重复提交">利用 JAVAScript 防止表单重复提交</h6><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">利用JAVAScript防止表单重复提交</span><span class="err">，</span><span class="n">做法就是JAVAScript控制Form表单只能提交一次</span>
<span class="o">&lt;!</span><span class="no">DOCTYPE</span> <span class="n">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">meta</span> <span class="n">charset</span><span class="o">=</span> <span class="s">"UTF-8"</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span> <span class="nc">Insert</span> <span class="n">title</span> <span class="n">here</span><span class="o">&lt;/</span><span class="n">title</span> <span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">script</span> <span class="n">type</span><span class="o">=</span> <span class="s">"text/javascript"</span><span class="o">&gt;</span>
        <span class="kt">var</span> <span class="n">isCommitted</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span><span class="c1">//表单是否已经提交标识，默认为false</span>
        <span class="n">function</span> <span class="nf">doSubmit</span><span class="o">(){</span>
                 <span class="k">if</span><span class="o">(</span><span class="n">isCommitted</span><span class="o">==</span><span class="kc">false</span><span class="o">)</span>
                 <span class="o">{</span>
                        <span class="n">isCommitted</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span><span class="c1">//提交表单后，将表单是否已经提交标识设置为true</span>
                         <span class="k">return</span> <span class="kc">true</span> <span class="o">;</span><span class="c1">//返回true让表单正常提交</span>
                 <span class="o">}</span> <span class="k">else</span><span class="o">{</span>
                         <span class="k">return</span> <span class="kc">false</span> <span class="o">;</span><span class="c1">//返回false那么表单将不提交</span>
                 <span class="o">}</span>
       <span class="o">}</span>

        <span class="n">function</span> <span class="nf">doSubmit2</span><span class="o">(){</span>
               <span class="kt">var</span> <span class="n">btnSubmit</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="na">getElementById</span><span class="o">(</span><span class="s">"submit"</span> <span class="o">);</span>
               <span class="c1">//将表单提交按钮设置为不可用，这样就可以避免用户再次点击提交按钮</span>
                <span class="n">btnSubmit</span><span class="o">.</span><span class="na">disabled</span><span class="o">=</span> <span class="s">"disabled"</span><span class="o">;</span>
               <span class="c1">//返回true让表单可以正常提交</span>
               <span class="k">return</span> <span class="kc">true</span> <span class="o">;</span>

       <span class="o">}</span>
<span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">form</span> <span class="n">action</span><span class="o">=</span> <span class="s">"/Servlet/session/DoFormServlet"</span> <span class="n">onsubmit</span><span class="o">=</span><span class="s">"doSubmit2();"</span> <span class="n">method</span><span class="o">=</span><span class="s">"post"</span> <span class="o">&gt;</span>
              <span class="n">用户名</span><span class="err">：</span> <span class="o">&lt;</span><span class="n">input</span> <span class="n">type</span><span class="o">=</span> <span class="s">"text"</span> <span class="n">name</span> <span class="o">=</span><span class="s">"username"</span><span class="o">&gt;</span>
               <span class="o">&lt;</span><span class="n">input</span> <span class="n">type</span><span class="o">=</span> <span class="s">"submit"</span> <span class="n">value</span> <span class="o">=</span><span class="s">"提交"</span> <span class="n">id</span><span class="o">=</span> <span class="s">"submit"</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</code></pre></div></div><h6 id="利用-session-防止表单重复提交">利用 session 防止表单重复提交</h6><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">对于上述场景二和场景三导致的重复提交</span><span class="err">，</span><span class="n">在客户端是无法解决的</span><span class="err">，</span><span class="n">只能在服务端使用SESSION来完成</span>
<span class="n">具体的做法</span><span class="err">：</span>
     <span class="n">在服务器端生成一个唯一的随机标识号</span><span class="err">，</span><span class="n">专业术语称为Token</span><span class="o">(</span><span class="n">令牌</span><span class="o">)</span><span class="err">，</span><span class="n">同时在当前用户的Session域中保存这个Token</span><span class="err">。</span>
<span class="n">然后将Token发送到客户端的Form表单中</span><span class="err">，</span><span class="n">在Form表单中使用隐藏域来存储这个Token</span><span class="err">，</span><span class="n">表单提交的时候连同这个Token一起提交到服务器端</span><span class="err">，</span>
<span class="n">然后在服务器端判断客户端提交上来的Token与服务器端生成的Token是否一致</span><span class="err">，</span><span class="n">如果不一致</span><span class="err">，</span><span class="n">那就是重复提交了</span><span class="err">，</span><span class="n">此时服务器端就可以不处理重复提交的表单</span><span class="err">。</span>
<span class="n">如果相同则处理表单提交</span><span class="err">，</span><span class="n">处理完后清除当前用户的Session域中存储的标识号</span><span class="err">。</span>

<span class="n">下面几种情况</span><span class="err">，</span><span class="n">服务器拒绝处理用户提交的请求</span><span class="err">：</span>
<span class="mi">1</span><span class="o">)</span> <span class="n">存储Session域中的Token令牌和表单提交的Token令牌不同</span>
<span class="mi">2</span><span class="o">)</span><span class="n">当前用户的Session中不存在Token令牌</span>
<span class="mi">3</span><span class="o">)</span><span class="n">用户提交的表单数据中没有Token令牌</span>
</code></pre></div></div><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span><span class="o">)</span> <span class="nc">FormServlet</span> <span class="n">用于生成Token</span><span class="o">(</span><span class="n">令牌</span><span class="o">)</span><span class="n">和跳转到form</span><span class="o">.</span><span class="na">jsp页面</span>
<span class="nd">@WebServlet</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"SESSION"</span> <span class="o">,</span><span class="n">urlPatterns</span><span class="o">=</span><span class="s">"/session/sessionForm"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SessionForm</span> <span class="kd">extends</span> <span class="nc">HttpServlet</span> <span class="o">{</span>

        <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doGet</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span>
                    <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
                     <span class="nc">String</span> <span class="n">token</span> <span class="o">=</span> <span class="nc">TokenProcessor</span><span class="o">.</span> <span class="nf">getInstance</span><span class="o">().</span><span class="na">makeToken</span><span class="o">();</span><span class="c1">//创建令牌</span>
                     <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"在FormServlet中生成的token："</span> <span class="o">+</span><span class="n">token</span><span class="o">);</span>
                     <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">setAttribute</span><span class="o">(</span> <span class="s">"token"</span><span class="o">,</span> <span class="n">token</span><span class="o">);</span>  <span class="c1">//在服务器使用session保存token(令牌)</span>
                     <span class="n">request</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span> <span class="s">"/sessionp/form.jsp"</span><span class="o">).</span><span class="na">forward</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span><span class="c1">//跳转到form.jsp页面</span>

            <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doPost</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span>
                    <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
               <span class="n">doGet</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
           <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">2</span><span class="o">)</span> <span class="n">后台生成的Token传递到前台页面中</span>
<span class="o">&lt;%</span><span class="err">@</span> <span class="n">page</span> <span class="n">language</span><span class="o">=</span><span class="s">"java"</span> <span class="n">contentType</span><span class="o">=</span><span class="s">"text/html; charset=utf-8"</span>
    <span class="n">pageEncoding</span><span class="o">=</span> <span class="s">"utf-8"</span><span class="o">%&gt;</span>
<span class="o">&lt;!</span><span class="no">DOCTYPE</span> <span class="n">html</span> <span class="no">PUBLIC</span> <span class="s">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="s">"http://www.w3.org/TR/html4/loose.dtd"</span> <span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">meta</span> <span class="n">http</span><span class="o">-</span><span class="n">equiv</span><span class="o">=</span><span class="s">"Content-Type"</span> <span class="n">content</span><span class="o">=</span><span class="s">"text/html; charset=ISO-8859-1"</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span> <span class="nc">Insert</span> <span class="n">title</span> <span class="n">here</span><span class="o">&lt;/</span><span class="n">title</span> <span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>

  <span class="o">&lt;</span><span class="n">form</span> <span class="n">action</span><span class="o">=</span><span class="s">"/Servlet/session/doFormServlet"</span> <span class="n">method</span> <span class="o">=</span><span class="s">"post"</span><span class="o">&gt;</span>
               <span class="o">&lt;</span><span class="n">input</span> <span class="n">type</span><span class="o">=</span> <span class="s">"hidden"</span> <span class="n">name</span> <span class="o">=</span><span class="s">"token"</span> <span class="n">value</span><span class="o">=</span><span class="s">"${token} "</span><span class="o">/&gt;</span>
              <span class="n">用户名</span><span class="err">：</span> <span class="o">&lt;</span><span class="n">input</span> <span class="n">type</span><span class="o">=</span> <span class="s">"text"</span> <span class="n">name</span> <span class="o">=</span><span class="s">"username"</span><span class="o">&gt;</span>
               <span class="o">&lt;</span><span class="n">input</span> <span class="n">type</span><span class="o">=</span> <span class="s">"submit"</span> <span class="n">value</span> <span class="o">=</span><span class="s">"提交"</span> <span class="n">id</span><span class="o">=</span> <span class="s">"submit"</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>

<span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</code></pre></div></div><p><img src="https://cdn.nlark.com/yuque/0/2021/png/659846/1635733751426-f4c4fc3d-b08a-4d88-ab8c-7984e55861ca.png#clientId=ua71ffd24-cc51-4&amp;from=paste&amp;height=140&amp;id=u55e80a72&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=205&amp;originWidth=1163&amp;originalType=binary&amp;ratio=1&amp;size=27447&amp;status=done&amp;style=none&amp;taskId=ub31feb3f-ef8e-4ccd-975b-6407f0fee80&amp;width=791.5" alt="image.png" /></p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">3</span><span class="err">）</span><span class="n">用于处理提交的表单</span>
<span class="nd">@WebServlet</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"dosession"</span> <span class="o">,</span><span class="n">urlPatterns</span><span class="o">=</span><span class="s">"/session/doSessionForm"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DoSessionForm</span>  <span class="kd">extends</span> <span class="nc">HttpServlet</span><span class="o">{</span>
        <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>
        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doGet</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">resp</span><span class="o">)</span>
                      <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
               <span class="kt">boolean</span> <span class="n">b</span> <span class="o">=</span> <span class="n">isRepeatSubmit</span><span class="o">(</span><span class="n">req</span><span class="o">);</span> <span class="c1">//判断是否重读提交了表单</span>
               <span class="k">if</span><span class="o">(</span><span class="n">b</span><span class="o">==</span><span class="kc">true</span> <span class="o">){</span>
                     <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"请不要重复提交"</span> <span class="o">);</span>
                      <span class="k">return</span> <span class="o">;</span>
              <span class="o">}</span>
              <span class="n">req</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">removeAttribute</span><span class="o">(</span> <span class="s">"token"</span><span class="o">);</span><span class="c1">//移除session中的token</span>
       <span class="o">}</span>
        <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">isRepeatSubmit</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>

              <span class="nc">String</span> <span class="n">client_token</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span> <span class="s">"token"</span><span class="o">);</span>

               <span class="k">if</span><span class="o">(</span><span class="n">client_token</span><span class="o">==</span><span class="kc">null</span><span class="o">){</span>
                     <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"required token=null"</span><span class="o">);</span>
                      <span class="k">return</span> <span class="kc">true</span> <span class="o">;</span>
              <span class="o">}</span>
               <span class="c1">//去除session中的token</span>
              <span class="nc">String</span> <span class="n">server_token</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"token"</span> <span class="o">);</span>
               <span class="c1">//如果当前用户中的Session不存在Token ，则用户重复提交了表单</span>
               <span class="k">if</span><span class="o">(</span><span class="n">server_token</span><span class="o">==</span><span class="kc">null</span><span class="o">){</span>
                     <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"session token=null"</span><span class="o">);</span>
                      <span class="k">return</span> <span class="kc">true</span> <span class="o">;</span>
              <span class="o">}</span>
               <span class="c1">//存储在session中的token和表单中提交的token不同则用户重复提交了表单</span>
               <span class="k">if</span><span class="o">(!</span><span class="n">client_token</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">server_token</span><span class="o">)){</span>
                     <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">" token still is the same"</span><span class="o">);</span>
                      <span class="k">return</span> <span class="kc">true</span> <span class="o">;</span>
              <span class="o">}</span>
               <span class="k">return</span> <span class="kc">false</span> <span class="o">;</span>
       <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doPost</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">resp</span><span class="o">)</span>
                      <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
               <span class="c1">// TODO Auto-generated method stub</span>
              <span class="n">doGet</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">resp</span><span class="o">);</span>
       <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">生成Token对应的值</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TokenProcessor</span> <span class="o">{</span>

        <span class="cm">/**
        * 单利设置模式（保证类的对象在内存中只有一个）
        * 1）把类的构造函数私有
        * 2）自己创建一个类
        * 3）对外提供一个公共的方法，返回类的对象
        */</span>
        <span class="kd">private</span> <span class="nf">TokenProcessor</span><span class="o">(){}</span>

        <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">TokenProcessor</span> <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TokenProcessor</span><span class="o">();</span>

        <span class="cm">/**
        * 获取对象实例
        */</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="nc">TokenProcessor</span> <span class="nf">getInstance</span><span class="o">(){</span>
               <span class="k">return</span> <span class="n">instance</span> <span class="o">;</span>
       <span class="o">}</span>

        <span class="cm">/**
        * 生成Token
        */</span>
        <span class="kd">public</span> <span class="nc">String</span> <span class="nf">makeToken</span><span class="o">(){</span>
              <span class="nc">String</span> <span class="n">token</span><span class="o">=(</span><span class="nc">System</span><span class="o">.</span> <span class="nf">currentTimeMillis</span><span class="o">()+</span><span class="k">new</span> <span class="nc">Random</span><span class="o">().</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">999999999</span><span class="o">))+</span><span class="s">""</span> <span class="o">;</span>
               <span class="k">try</span> <span class="o">{</span>
                     <span class="nc">MessageDigest</span> <span class="n">md</span> <span class="o">=</span> <span class="nc">MessageDigest</span><span class="o">.</span> <span class="nf">getInstance</span><span class="o">(</span><span class="s">"md5"</span><span class="o">);</span>
                      <span class="kt">byte</span> <span class="n">md5</span><span class="o">[]=</span> <span class="n">md</span><span class="o">.</span><span class="na">digest</span><span class="o">(</span><span class="n">token</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
                     <span class="nc">BASE64Encoder</span> <span class="n">encoder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BASE64Encoder</span><span class="o">();</span>
                      <span class="k">return</span> <span class="n">encoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">md5</span><span class="o">);</span>
              <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                      <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
              <span class="o">}</span>

       <span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div><h3 id="过滤器-fliter-的介绍">过滤器 fliter 的介绍</h3><h4 id="filter-的简介">filter 的简介</h4><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Filter也称之为过滤器</span><span class="err">，</span><span class="n">是Servlet技术中最激动人心的技术</span><span class="err">，</span><span class="nc">WEB开发人员通过Filter技术</span><span class="err">，</span><span class="n">对WEB服务器管理的所有WEB资源</span><span class="err">。</span><span class="n">例如</span> <span class="no">JSP</span> <span class="nc">Servlet</span><span class="o">,</span><span class="n">静态图片文件或静态HTML文件等进行拦截</span><span class="err">，</span><span class="n">从而实现</span>
<span class="n">一些特殊的功能</span><span class="err">，</span><span class="n">例如实现URL级别权限访问控制</span><span class="err">，</span><span class="n">过滤敏感词汇</span><span class="err">，</span><span class="n">压缩响应信息等一些高级功能</span>

<span class="nc">ServletAPI</span> <span class="n">提供了一个Filter接口</span><span class="err">，</span><span class="n">开发WEB应用时</span><span class="err">，</span><span class="n">如果编写的JAVA类实现了这个接口</span><span class="err">，</span><span class="n">则把JAVA类称之为Filter</span><span class="o">.</span><span class="na">通过Filter技术可以实现用户访问某个目标之前对访问的请求和响应进行拦截</span>

<span class="nc">Filter是如何实现拦截的</span>
<span class="nc">Filter接口中有一个doFilter</span><span class="o">()</span><span class="n">方法</span><span class="err">，</span><span class="n">我们编写好Filter</span><span class="err">，</span><span class="n">并配置web资源进行拦截后</span><span class="err">，</span><span class="nc">WEB服务器每次在调用web资源的service方法之前</span><span class="err">，</span><span class="n">都先调用一下filter的dofilter方法</span><span class="err">，</span><span class="n">因此</span><span class="err">，</span><span class="n">在该方法内编写</span>
<span class="n">代码</span><span class="err">，</span><span class="n">可达到如下目的</span><span class="err">：</span>
<span class="mi">1</span><span class="err">）</span><span class="n">调用目标资源之前</span><span class="err">，</span><span class="n">让一段代码执行</span>
<span class="mi">2</span><span class="err">）</span><span class="n">是否调用目标资源</span><span class="o">(</span><span class="n">即是否让用户访问web资源</span><span class="o">)</span>
<span class="mi">3</span><span class="err">）</span><span class="n">调用目标资源之后</span><span class="err">，</span><span class="n">让一段代码执行</span>

<span class="n">web服务器在调用doFilter方法时</span><span class="err">，</span><span class="n">会传递一个filtChain对象进来</span><span class="err">，</span><span class="n">filtChain对象是filter接口中最重要的一个对象</span><span class="err">，</span><span class="n">它也提供了一个doFilter</span><span class="err">（）</span><span class="n">方法</span><span class="err">，</span><span class="n">开发人员可以根据需求决定是否调用此方法</span><span class="err">，</span>
<span class="n">调用该方法</span><span class="err">，</span><span class="n">则web服务器就会调用web资源的service方法</span><span class="err">，</span><span class="n">即web资源就会被访问</span><span class="err">，</span><span class="n">否则web资源不会被访问</span><span class="err">。</span>

</code></pre></div></div><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FilterDemo01</span> <span class="kd">implements</span> <span class="nc">Filter</span> <span class="o">{</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"----过滤器销毁----"</span> <span class="o">);</span>
       <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="nc">ServletRequest</span> <span class="n">arg0</span><span class="o">,</span> <span class="nc">ServletResponse</span> <span class="n">arg1</span><span class="o">,</span>
                     <span class="nc">FilterChain</span> <span class="n">arg2</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span> <span class="o">{</span>
                <span class="c1">//对request和response进行一些预处理</span>
              <span class="n">arg0</span><span class="o">.</span><span class="na">setCharacterEncoding</span><span class="o">(</span> <span class="s">"UTF-8"</span><span class="o">);</span>
              <span class="n">arg1</span><span class="o">.</span><span class="na">setCharacterEncoding</span><span class="o">(</span> <span class="s">"UTF-8"</span><span class="o">);</span>
              <span class="n">arg1</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span> <span class="s">"text/html;charset=UTF-8"</span><span class="o">);</span>

              <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"FilterDemo01执行前！！！"</span> <span class="o">);</span>
              <span class="n">arg2</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">arg0</span><span class="o">,</span> <span class="n">arg1</span><span class="o">);</span>  <span class="c1">//让目标资源执行，放行</span>
              <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"FilterDemo01执行后！！！"</span> <span class="o">);</span>

       <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="nc">FilterConfig</span> <span class="n">arg0</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"----过滤器初始化----"</span> <span class="o">);</span>
       <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="n">filter</span> <span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">filter</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="n">demo01</span><span class="o">&lt;/</span> <span class="n">filter</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">filter</span><span class="o">-</span><span class="kd">class</span><span class="err">&gt;</span> <span class="nc">com</span><span class="o">.</span><span class="na">Filter</span><span class="o">.</span><span class="na">FilterDemo01</span><span class="o">&lt;/</span><span class="n">filter</span><span class="o">-</span><span class="kd">class</span> <span class="err">&gt;</span>
<span class="err">&lt;/</span><span class="nc">filter</span> <span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">filter</span><span class="o">-</span><span class="n">mapping</span> <span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">filter</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="n">demo01</span><span class="o">&lt;/</span> <span class="n">filter</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
      <span class="o">&lt;!--</span> <span class="o">/*</span> <span class="n">表示拦截所有请求</span> <span class="o">--&gt;</span>
   <span class="o">&lt;</span><span class="n">url</span><span class="o">-</span><span class="n">pattern</span><span class="o">&gt;</span> <span class="o">/*&lt;/</span> <span class="n">url</span><span class="o">-</span><span class="n">pattern</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">filter</span><span class="o">-</span><span class="n">mapping</span> <span class="o">&gt;</span>
</code></pre></div></div><h5 id="filter-链">filter 链</h5><blockquote><p><em>一个 web 应用中，可以开发编写多个 Filter，这些 Filter 组合起来称之为 Filter 链 web 服务器根据 Filter 在 web.xml 文件中注册顺序，决定先调用那个 Filter，当第一个 Filter 的 do Filter 方法被调用时，web 服务器会创建一个代表 Filter 链的 FilterChain 对象传递给该方法。在 doFilter 方法中，开发人员如果调用了 FilterChain 对象的 doFilter 方法，则 web 服务器会检查 FilterChain 对象中是否还有 filter，如果有，则调用第二个 filter，如果没有则调用目标资源。</em>​</p></blockquote><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="n">filter</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">filter</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="n">demo01</span><span class="o">&lt;/</span> <span class="n">filter</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">filter</span><span class="o">-</span><span class="kd">class</span><span class="err">&gt;</span> <span class="nc">com</span><span class="o">.</span><span class="na">Filter</span><span class="o">.</span><span class="na">FilterDemo01</span><span class="o">&lt;/</span><span class="n">filter</span><span class="o">-</span><span class="kd">class</span> <span class="err">&gt;</span>
<span class="err">&lt;/</span><span class="nc">filter</span> <span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">filter</span><span class="o">-</span><span class="n">mapping</span> <span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">filter</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="n">demo01</span><span class="o">&lt;/</span> <span class="n">filter</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
     <span class="o">&lt;!--</span> <span class="o">/*</span> <span class="n">表示拦截所有请求</span> <span class="o">--&gt;</span>
     <span class="o">&lt;</span><span class="n">url</span><span class="o">-</span><span class="n">pattern</span><span class="o">&gt;</span> <span class="o">/*&lt;/</span> <span class="n">url</span><span class="o">-</span><span class="n">pattern</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">filter</span><span class="o">-</span><span class="n">mapping</span> <span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">filter</span> <span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">filter</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="n">demo02</span><span class="o">&lt;/</span> <span class="n">filter</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">filter</span><span class="o">-</span><span class="kd">class</span><span class="err">&gt;</span> <span class="nc">com</span><span class="o">.</span><span class="na">Filter</span><span class="o">.</span><span class="na">FilterDemo02</span><span class="o">&lt;/</span><span class="n">filter</span><span class="o">-</span><span class="kd">class</span> <span class="err">&gt;</span>
<span class="err">&lt;/</span><span class="nc">filter</span> <span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">filter</span><span class="o">-</span><span class="n">mapping</span> <span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">filter</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="n">demo02</span><span class="o">&lt;/</span> <span class="n">filter</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
     <span class="o">&lt;!--</span> <span class="o">/*</span> <span class="n">表示拦截所有请求</span> <span class="o">--&gt;</span>
     <span class="o">&lt;</span><span class="n">url</span><span class="o">-</span><span class="n">pattern</span><span class="o">&gt;</span> <span class="o">/*&lt;/</span> <span class="n">url</span><span class="o">-</span><span class="n">pattern</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">filter</span><span class="o">-</span><span class="n">mapping</span> <span class="o">&gt;</span>
</code></pre></div></div><h5 id="filter-的工作原理">filter 的工作原理</h5><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">当客户端发出Web资源的请求时</span><span class="err">，</span><span class="nc">Web服务器根据应用程序配置文件设置的过滤规则进行检查</span><span class="err">，</span><span class="n">若客户请求满足过滤规则</span><span class="err">，</span><span class="n">则对客户请求</span><span class="err">／</span><span class="n">响应进行拦截</span><span class="err">，</span>
<span class="n">对请求头和请求数据进行检查或改动</span><span class="err">，</span><span class="n">并依次通过过滤器链</span><span class="err">，</span><span class="n">最后把请求</span><span class="err">／</span><span class="n">响应交给请求的Web资源处理</span><span class="err">。</span><span class="n">请求信息在过滤器链中可以被修改</span><span class="err">，</span>
<span class="n">也可以根据条件让请求不发往资源处理器</span><span class="err">，</span><span class="n">并直接向客户机发回一个响应</span><span class="err">。</span><span class="n">当资源处理器完成了对资源的处理后</span><span class="err">，</span><span class="n">响应信息将逐级逆向返回</span><span class="err">。</span>
<span class="n">同样在这个过程中</span><span class="err">，</span><span class="n">用户可以修改响应信息</span><span class="err">，</span><span class="n">从而完成一定的任务</span><span class="err">。</span>

<span class="n">关于过滤链的问题</span><span class="err">：</span><span class="n">上面说了</span><span class="err">，</span><span class="n">当一个请求符合某个过滤器的过滤条件时该请求就会交给这个过滤器去处理</span><span class="err">。</span><span class="n">那么当两个过滤器同时过滤一个请求时谁先谁后呢</span><span class="err">？</span><span class="n">这就涉及到了过滤链FilterChain</span><span class="err">。</span>
<span class="n">所有的奥秘都在Filter的FilterChain中</span><span class="err">。</span><span class="n">服务器会按照web</span><span class="o">.</span><span class="na">xml中过滤器定义的先后循序组装成一条链</span><span class="err">，</span><span class="n">然后一次执行其中的doFilter</span><span class="o">()</span><span class="n">方法</span><span class="err">。</span>
<span class="n">执行的顺序</span><span class="err">，</span><span class="n">执行第一个过滤器的chain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">()</span><span class="n">之前的代码</span><span class="err">，</span><span class="n">第二个过滤器的chain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">()</span><span class="n">之前的代码</span><span class="err">，</span><span class="n">请求的资源</span><span class="err">，</span><span class="n">第二个过滤器的chain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">()</span><span class="n">之后的代码</span><span class="err">，</span><span class="n">第一个过滤器的chain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">()</span><span class="n">之后的代码</span><span class="err">，</span><span class="n">最后返回响应</span><span class="err">。</span>

<span class="n">上面说的</span><span class="err">“</span><span class="n">执行请求的资源</span><span class="err">”</span><span class="n">究竟是怎么执行的</span><span class="err">？</span><span class="n">对于</span><span class="err">“</span><span class="n">执行第一个过滤器的chain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">()</span><span class="n">之前的代码</span><span class="err">，</span><span class="n">第二个过滤器的chain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">()</span><span class="n">之前的代码</span><span class="err">”</span><span class="n">这些我可以理解</span><span class="err">，</span><span class="n">无非就是按顺序执行一句句的代码</span><span class="err">，</span>
<span class="n">但对于这个</span><span class="err">“</span><span class="n">执行请求的资源</span><span class="err">”</span><span class="n">其实是这样的</span><span class="err">：</span><span class="n">通常我们所访问的资源是一个servlet或jsp页面</span><span class="err">，</span><span class="n">而jsp其实是一个被封装了的servlet</span><span class="err">，</span><span class="n">于是我们就可以统一地认为我们每次访问的都是一个Servlet</span><span class="o">,</span><span class="n">而每当我们访问一个servlet时</span><span class="err">，</span>
<span class="n">web容器都会调用该Servlet的service方法去处理请求</span><span class="err">。</span><span class="n">而在service方法又会根据请求方式的不同</span><span class="err">（</span><span class="nc">Get</span><span class="o">/</span><span class="nc">Post</span><span class="err">）</span><span class="n">去调用相应的doGet</span><span class="o">()</span><span class="n">或doPost</span><span class="o">()</span><span class="n">方法</span><span class="err">，</span><span class="n">实际处理请求的就是这个doGet或doPost方法</span><span class="err">。</span>
<span class="n">在doGet</span><span class="err">（</span><span class="n">或doPost</span><span class="err">）</span><span class="n">方法中是通过response</span><span class="o">.</span><span class="na">getWriter</span><span class="err">（）</span><span class="n">得到客户端的输出流对象</span><span class="err">，</span><span class="n">然后用此对象对客户进行响应</span><span class="err">。</span>
<span class="n">到这里我们就应该理解了过滤器的执行流程了</span><span class="err">：</span>

<span class="n">执行第一个过滤器的chain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">()</span><span class="n">之前的代码</span>
<span class="err">——</span><span class="o">&gt;</span><span class="n">第二个过滤器的chain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">()</span><span class="n">之前的代码</span>
<span class="err">——</span><span class="o">&gt;</span><span class="err">……</span>
<span class="err">——</span><span class="o">&gt;</span><span class="n">第n个过滤器的chain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">()</span><span class="n">之前的代码</span>
<span class="err">——</span><span class="o">&gt;</span><span class="n">所请求servlet的service</span><span class="o">()</span><span class="n">方法中的代码</span>
<span class="err">——</span><span class="o">&gt;</span><span class="n">所请求servlet的doGet</span><span class="o">()</span><span class="n">或doPost</span><span class="o">()</span><span class="n">方法中的代码</span>
<span class="err">——</span><span class="o">&gt;</span><span class="n">第n个过滤器的chain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">()</span><span class="n">之后的代码</span>
<span class="err">——</span><span class="o">&gt;</span><span class="err">……</span>
<span class="err">——</span><span class="o">&gt;</span><span class="n">第二个过滤器的chain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">()</span><span class="n">之后的代码</span>
<span class="err">——</span><span class="o">&gt;</span><span class="n">第一个过滤器的chain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">()</span><span class="n">之后的代码</span><span class="err">。</span>
</code></pre></div></div><h5 id="filter-的生命周期">filter 的生命周期</h5><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span><span class="o">)</span> <span class="nc">Filter的创建</span>
     <span class="nc">Filter的创建和销毁由web服务器负责</span><span class="err">。</span>
     <span class="n">web应用程序启动时</span><span class="err">，</span><span class="n">web服务器将创建Filter的实例对象并调用器init方法</span><span class="err">，</span><span class="n">完成对象的初始化功能</span><span class="err">，</span><span class="n">从而为后续的用户请求做好拦截的准备工作</span><span class="err">。</span>
     <span class="nc">Filter对象只会创建一次init方法也只会执行一次</span><span class="err">，</span><span class="n">通过init</span><span class="err">（）</span><span class="n">方法的参数</span><span class="err">，</span><span class="n">可获得当前filter配置信息的FilterConfig对象</span>

<span class="mi">2</span><span class="err">）</span><span class="nc">Filter的销毁</span>
     <span class="n">web容器调用destory方法销毁Filter</span><span class="o">.</span><span class="na">destory方法在Filter方法周期中仅仅执行一次</span><span class="err">。</span>
     <span class="n">在destory方法中</span><span class="err">，</span><span class="n">可以释放过滤器使用的资源</span><span class="err">。</span>

<span class="mi">3</span><span class="err">）</span><span class="nc">FilterConfig接口</span>
     <span class="n">用户在配置filter时</span><span class="err">，</span><span class="n">可以使用</span><span class="o">&lt;</span><span class="n">init</span><span class="o">-</span><span class="n">param</span><span class="o">&gt;</span><span class="n">为Filter配置一些初始化参数</span><span class="err">，</span><span class="n">当web容器实例化Filter对象</span><span class="err">，</span><span class="n">调用其init方法时</span><span class="err">，</span><span class="n">会把封装了Filter初始化参数的FilterConfig对象传递进来</span><span class="err">。</span>
     <span class="n">因此开发人员在编写filter时</span><span class="err">，</span><span class="n">通过filterConfig对象的方法</span><span class="err">，</span><span class="n">就可获得</span>

     <span class="nc">String</span> <span class="nf">getFilterName</span><span class="o">();</span>
    		<span class="n">得到filter的名称</span>
     <span class="nc">String</span> <span class="n">getInitParameter</span><span class="err">（</span><span class="nc">String</span> <span class="n">name</span><span class="o">);</span>
     		<span class="n">返回在部署描述中指定名称的初始化参数的值</span><span class="err">，</span><span class="n">如果不存在返回null</span>
     <span class="nc">Enumeration</span> <span class="nf">getInitParameterNames</span><span class="o">(</span> <span class="o">);</span>
			<span class="n">返回过滤器的所有参数的名字的枚举集合</span>
     <span class="kd">public</span> <span class="nc">ServletContext</span> <span class="nf">getServletContext</span><span class="o">();</span>
 			<span class="n">返回Servlet上下文对象的引用</span>

</code></pre></div></div><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">&lt;</span><span class="n">filter</span> <span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">filter</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="n">demo02</span><span class="o">&lt;/</span> <span class="n">filter</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">filter</span><span class="o">-</span><span class="kd">class</span><span class="err">&gt;</span> <span class="nc">com</span><span class="o">.</span><span class="na">Filter</span><span class="o">.</span><span class="na">FilterDemo02</span><span class="o">&lt;/</span><span class="n">filter</span><span class="o">-</span><span class="kd">class</span> <span class="err">&gt;</span>
           <span class="err">&lt;</span><span class="nc">init</span><span class="o">-</span><span class="n">param</span><span class="o">&gt;</span>
               <span class="o">&lt;</span><span class="n">description</span><span class="o">&gt;</span> <span class="n">名字</span><span class="o">&lt;/</span><span class="n">description</span> <span class="o">&gt;</span>
               <span class="o">&lt;</span><span class="n">param</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="n">name</span><span class="o">&lt;/</span> <span class="n">param</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
               <span class="o">&lt;</span><span class="n">param</span><span class="o">-</span><span class="n">value</span><span class="o">&gt;</span> <span class="n">ssgao</span><span class="o">&lt;/</span><span class="n">param</span><span class="o">-</span><span class="n">value</span> <span class="o">&gt;</span>
          <span class="o">&lt;/</span><span class="n">init</span><span class="o">-</span><span class="n">param</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="n">init</span><span class="o">-</span><span class="n">param</span><span class="o">&gt;</span>
               <span class="o">&lt;</span><span class="n">description</span><span class="o">&gt;</span> <span class="n">兴趣</span><span class="o">&lt;/</span><span class="n">description</span> <span class="o">&gt;</span>
               <span class="o">&lt;</span><span class="n">param</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="n">like</span><span class="o">&lt;/</span> <span class="n">param</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
               <span class="o">&lt;</span><span class="n">param</span><span class="o">-</span><span class="n">value</span><span class="o">&gt;</span> <span class="n">book</span><span class="o">&lt;/</span> <span class="n">param</span><span class="o">-</span><span class="n">value</span><span class="o">&gt;</span>
          <span class="o">&lt;/</span><span class="n">init</span><span class="o">-</span><span class="n">param</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">filter</span> <span class="o">&gt;</span>

   <span class="o">&lt;</span><span class="n">filter</span><span class="o">-</span><span class="n">mapping</span> <span class="o">&gt;</span>
         <span class="o">&lt;</span><span class="n">filter</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="n">demo02</span><span class="o">&lt;/</span> <span class="n">filter</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
         <span class="o">&lt;!--</span> <span class="o">/*</span> <span class="n">表示拦截所有请求</span> <span class="o">--&gt;</span>
          <span class="o">&lt;</span><span class="n">url</span><span class="o">-</span><span class="n">pattern</span><span class="o">&gt;</span> <span class="o">/*&lt;/</span> <span class="n">url</span><span class="o">-</span><span class="n">pattern</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">filter</span><span class="o">-</span><span class="n">mapping</span> <span class="o">&gt;</span>

 <span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="nc">FilterConfig</span> <span class="n">arg0</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span> <span class="o">{</span>
     <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"----2过滤器初始化----"</span> <span class="o">);</span>
     <span class="c1">//得到过滤器的名字</span>
     <span class="nc">String</span> <span class="n">filterName</span> <span class="o">=</span> <span class="n">arg0</span><span class="o">.</span><span class="na">getFilterName</span><span class="o">();</span>
     <span class="c1">//得到在web。xml稳重配置的初始化参数</span>
     <span class="nc">String</span> <span class="n">initParam1</span> <span class="o">=</span> <span class="n">arg0</span><span class="o">.</span><span class="na">getInitParameter</span><span class="o">(</span> <span class="s">"name"</span><span class="o">);</span>
     <span class="nc">String</span> <span class="n">initParam2</span> <span class="o">=</span> <span class="n">arg0</span><span class="o">.</span><span class="na">getInitParameter</span><span class="o">(</span> <span class="s">"like"</span><span class="o">);</span>

     <span class="c1">//返回所有的厨师话参数的枚举集合</span>
     <span class="nc">Enumeration</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">initParamterNames</span> <span class="o">=</span> <span class="n">arg0</span><span class="o">.</span><span class="na">getInitParameterNames</span><span class="o">();</span>
     <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">filterName</span><span class="o">);</span>
     <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">initParam1</span><span class="o">);</span>
     <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">initParam2</span><span class="o">);</span>

     <span class="k">while</span><span class="o">(</span><span class="n">initParamterNames</span><span class="o">.</span><span class="na">hasMoreElements</span><span class="o">()){</span>
           <span class="nc">String</span> <span class="n">paramNameString</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">initParamterNames</span><span class="o">.</span><span class="na">nextElement</span><span class="o">();</span>
           <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">paramNameString</span><span class="o">);</span>
     <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div><h4 id="filter-的部署">filter 的部署</h4><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Filter的部署分为下面两个步骤</span>
     <span class="mi">1</span><span class="err">）</span><span class="n">注册Filter</span>
     <span class="mi">2</span><span class="err">）</span><span class="n">映射Filter</span>
</code></pre></div></div><h4 id="filter-的注册">filter 的注册</h4><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">开发好Filter之后</span><span class="err">，</span><span class="n">需要在web</span><span class="o">.</span><span class="na">xml文件中进行注册</span><span class="err">，</span><span class="n">这样才能够被web服务器调用</span>
   <span class="o">&lt;</span><span class="n">filter</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">filter</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="n">demo02</span><span class="o">&lt;/</span> <span class="n">filter</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">filter</span><span class="o">-</span><span class="kd">class</span><span class="err">&gt;</span> <span class="nc">com</span><span class="o">.</span><span class="na">Filter</span><span class="o">.</span><span class="na">FilterDemo02</span><span class="o">&lt;/</span><span class="n">filter</span><span class="o">-</span><span class="kd">class</span> <span class="err">&gt;</span>
       <span class="err">&lt;</span><span class="nc">init</span><span class="o">-</span><span class="n">param</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">description</span><span class="o">&gt;</span> <span class="n">名字</span><span class="o">&lt;/</span><span class="n">description</span> <span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">param</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="n">name</span><span class="o">&lt;/</span> <span class="n">param</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">param</span><span class="o">-</span><span class="n">value</span><span class="o">&gt;</span> <span class="n">ssgao</span><span class="o">&lt;/</span><span class="n">param</span><span class="o">-</span><span class="n">value</span> <span class="o">&gt;</span>
       <span class="o">&lt;/</span><span class="n">init</span><span class="o">-</span><span class="n">param</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">filter</span> <span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">description</span><span class="o">&gt;</span><span class="n">用于添加描述信息</span><span class="err">，</span><span class="n">该元素内容可以为空</span><span class="err">，</span><span class="o">&lt;</span><span class="n">description</span><span class="o">&gt;</span><span class="n">可以不配置</span>
     <span class="o">&lt;</span><span class="n">filter</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="n">用于为过滤器指定一个名字</span><span class="err">，</span><span class="n">该元素的内容不能为空</span>
     <span class="o">&lt;</span><span class="n">filter</span><span class="o">-</span><span class="kd">class</span><span class="err">&gt;</span>  <span class="nc">元素用于指定过滤器完整的限定类名</span>
     <span class="o">&lt;</span><span class="n">init</span><span class="o">-</span><span class="n">param</span><span class="o">&gt;</span> <span class="n">元素用于为过滤器指定初始化参数</span><span class="err">，</span><span class="n">它的子元素</span><span class="o">&lt;</span><span class="n">param</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span><span class="n">指定参数的名字</span>   <span class="o">&lt;</span><span class="n">param</span><span class="o">-</span><span class="n">value</span><span class="o">&gt;</span> <span class="n">指定参数的值</span>
<span class="n">在过滤器中</span><span class="err">，</span><span class="n">可以使用FilterConfig接口对象来访问初始化参数</span><span class="err">。</span><span class="n">如果过滤器不需要指定初始化参数</span><span class="err">，</span><span class="n">那么</span><span class="o">&lt;</span><span class="n">init</span><span class="o">-</span><span class="n">param</span><span class="o">&gt;</span><span class="n">元素可以不配置</span>

</code></pre></div></div><h4 id="filter-的映射">filter 的映射</h4><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">在web</span><span class="o">.</span><span class="na">xml文件中</span><span class="err">，</span><span class="n">注册了Filter之后</span><span class="err">，</span><span class="n">还要在web</span><span class="o">.</span><span class="na">xml文件中映射Filter</span>
 <span class="o">&lt;</span><span class="n">filter</span><span class="o">-</span><span class="n">mapping</span> <span class="o">&gt;</span>
               <span class="o">&lt;</span><span class="n">filter</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="n">demo02</span><span class="o">&lt;/</span> <span class="n">filter</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
               <span class="o">&lt;!--</span> <span class="o">/*</span> <span class="n">表示拦截所有请求</span> <span class="o">--&gt;</span>
               <span class="o">&lt;</span><span class="n">url</span><span class="o">-</span><span class="n">pattern</span><span class="o">&gt;</span> <span class="o">/*&lt;/</span> <span class="n">url</span><span class="o">-</span><span class="n">pattern</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="n">dispatcher</span><span class="o">&gt;</span><span class="no">REQUEST</span><span class="o">&lt;/</span><span class="n">dispatcher</span><span class="o">&gt;</span>
             <span class="o">&lt;</span><span class="n">dispatcher</span><span class="o">&gt;</span><span class="no">FORWARD</span><span class="o">&lt;/</span><span class="n">dispatcher</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">filter</span><span class="o">-</span><span class="n">mapping</span> <span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">filter</span><span class="o">-</span><span class="n">mapping</span><span class="o">&gt;</span><span class="n">元素用于设置一个Filter所负责拦截的资源</span><span class="err">。</span><span class="n">一个Filter拦截资源可通过两种方式来指定</span><span class="err">：</span><span class="nc">Servlet名称和资源访问的请求路径</span>
<span class="o">&lt;</span><span class="n">filter</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="n">子元素用于设置Filter的注册名称</span><span class="err">。</span><span class="n">该值是</span><span class="o">&lt;</span><span class="n">filter</span><span class="o">&gt;</span><span class="n">元素中声明过的过滤器名字</span>
<span class="o">&lt;</span><span class="n">url</span><span class="o">-</span><span class="n">pattern</span><span class="o">&gt;</span> <span class="n">设置Filter所拦截的请求路劲</span>
<span class="o">&lt;</span><span class="n">servlet</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="n">指定过滤器所拦截的Servlet名称</span>
<span class="o">&lt;</span><span class="n">dispatcher</span><span class="o">&gt;</span><span class="n">指定过滤器所拦截的资源被Servlet容器调用的方式</span><span class="err">，</span><span class="n">可以是REQUEST</span><span class="o">,</span><span class="no">INCLUDE</span><span class="o">,</span><span class="no">FORWORD</span><span class="o">,</span><span class="nc">ERROR之一默认是REQUEST</span><span class="o">,</span><span class="n">用户可以设置多个</span><span class="o">&lt;</span><span class="n">dispatcher</span><span class="o">&gt;</span><span class="n">子元素来指定</span><span class="o">&lt;</span><span class="nc">Filter</span><span class="o">&gt;</span><span class="n">对资源多种调用方式进行拦截</span>

<span class="o">&lt;</span><span class="n">dispatcher</span><span class="o">&gt;</span><span class="n">子元素可以设置的值及其意义</span><span class="err">：</span>
<span class="mi">1</span><span class="err">）</span><span class="nl">REQUEST:</span> <span class="n">当用户直接访问页面时</span><span class="o">,</span><span class="n">web</span> <span class="n">容器将会调用过滤器</span><span class="err">。</span><span class="n">如果目标资源是通过RequestDispacher的include</span><span class="err">（）</span><span class="n">或forword</span><span class="err">（）</span><span class="n">方法访问时</span><span class="err">，</span><span class="n">那么该过滤器就不会被调用</span>
<span class="mi">2</span><span class="err">）</span><span class="no">INCLUDE</span><span class="err">：</span> <span class="n">如果目标资源通过RequestDispacher的include</span><span class="err">（）</span><span class="n">方法访问时</span><span class="err">，</span><span class="n">那么该过滤器将被调用</span><span class="err">。</span><span class="n">除此之外</span><span class="err">，</span><span class="n">该过滤器不会被调用</span>
<span class="mi">3</span><span class="err">）</span><span class="nl">FORWORD:</span> <span class="n">如果目标资源是通过REQUESTDispacher的forword</span><span class="o">()</span><span class="n">方法访问时</span><span class="err">，</span><span class="n">那么该过滤器将被调用</span><span class="err">，</span><span class="n">除此之外</span><span class="err">，</span><span class="n">该过滤器不会被调用</span>
<span class="mi">4</span><span class="err">）</span><span class="nl">ERROR:</span><span class="n">如果目标资源时通过声明异常处理机制调用时</span><span class="err">，</span><span class="n">那么该过滤器将被调用</span><span class="err">。</span><span class="n">除此之外过滤器不会被调用</span>
</code></pre></div></div><h4 id="filter-的注解">filter 的注解</h4><blockquote><p><em>Servlet 3.0 提供@WebFilter 注解将一个实现了 javax.servlet.Filter 接口的类定义为过滤器，这样我们在 web 应用中使用过滤器时，也不再需要在 web.xml 文件中配置</em>过滤器的相关描述_​</p></blockquote><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 *使用注解过滤器
 *@Webfilter将一个实现了javax.servlet.Filter接口的类定义为过滤器
 *属性filerName声明过滤器的名称，可选
 *属性urlPatterns指定要过滤的URL模式，也可使用属性value来声明(指定要过滤的URL模式是必选属性)
 *
 */</span>
<span class="nd">@WebFilter</span><span class="o">(</span><span class="n">filterName</span><span class="o">=</span><span class="s">"demo01"</span> <span class="o">,</span><span class="n">urlPatterns</span><span class="o">=</span><span class="s">"/*"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FilterDemo01</span> <span class="kd">implements</span> <span class="nc">Filter</span> <span class="o">{</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"----1过滤器销毁----"</span> <span class="o">);</span>
       <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="nc">ServletRequest</span> <span class="n">arg0</span><span class="o">,</span> <span class="nc">ServletResponse</span> <span class="n">arg1</span><span class="o">,</span>
                     <span class="nc">FilterChain</span> <span class="n">arg2</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span> <span class="o">{</span>
                <span class="c1">//对request和response进行一些预处理</span>
              <span class="n">arg0</span><span class="o">.</span><span class="na">setCharacterEncoding</span><span class="o">(</span> <span class="s">"UTF-8"</span><span class="o">);</span>
              <span class="n">arg1</span><span class="o">.</span><span class="na">setCharacterEncoding</span><span class="o">(</span> <span class="s">"UTF-8"</span><span class="o">);</span>
              <span class="n">arg1</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span> <span class="s">"text/html;charset=UTF-8"</span><span class="o">);</span>

              <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"FilterDemo01执行前！！！"</span> <span class="o">);</span>
              <span class="n">arg2</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">arg0</span><span class="o">,</span> <span class="n">arg1</span><span class="o">);</span>  <span class="c1">//让目标资源执行，放行</span>
              <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"FilterDemo01执行后！！！"</span> <span class="o">);</span>

       <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="nc">FilterConfig</span> <span class="n">arg0</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"----1过滤器初始化----"</span> <span class="o">);</span>
       <span class="o">}</span>

<span class="o">}</span>


</code></pre></div></div><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">含有初始化删除的注解</span>


<span class="nd">@WebFilter</span><span class="o">(</span>
    	 <span class="n">urlPatterns</span> <span class="o">={</span><span class="s">"/servlet/*"</span> <span class="o">},</span>
         <span class="n">asyncSupported</span><span class="o">=</span> <span class="kc">true</span><span class="o">,</span>
         <span class="n">dispatcherTypes</span><span class="o">={</span><span class="nc">DispatcherType</span><span class="o">.</span><span class="na">REQUEST</span><span class="o">},</span>
         <span class="n">initParams</span><span class="o">=</span><span class="nd">@WebInitParam</span> <span class="o">(</span><span class="n">name</span><span class="o">=</span> <span class="s">"param1"</span><span class="o">,</span> <span class="n">value</span><span class="o">=</span> <span class="s">"value1"</span><span class="o">))</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExampleFilter</span> <span class="kd">implements</span> <span class="nc">Filter</span> <span class="o">{</span>

   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"destory filter……"</span> <span class="o">);</span>
   <span class="o">}</span>

   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="nc">ServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">ServletResponse</span> <span class="n">response</span><span class="o">,</span>
         <span class="nc">FilterChain</span> <span class="n">chain</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"filter……"</span> <span class="o">);</span>
      <span class="n">chain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="nc">FilterConfig</span> <span class="n">filterConfig</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span> <span class="o">{</span>
      <span class="nc">String</span> <span class="n">param1</span> <span class="o">=</span> <span class="n">filterConfig</span><span class="o">.</span><span class="na">getInitParameter</span><span class="o">(</span> <span class="s">"param1"</span><span class="o">);</span>
      <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"filter init……"</span> <span class="o">+</span> <span class="n">param1</span><span class="o">);</span>
   <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><h3 id="监听器-listener-的介绍">监听器 listener 的介绍</h3><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">监听器就是一个实现特定接口的普通java程序</span><span class="err">，</span><span class="n">这个程序专门用于监听另外一个java对象的方法调用或属性的改变</span><span class="err">，</span>
<span class="n">当被监听的对象发生上述事件后</span><span class="err">，</span><span class="n">监听器某个方法将被立即执行</span><span class="o">.</span>

<span class="n">监听器是一个专门用于对其他对象身上发生的事件或状态改变进行监听相应处理的对象</span><span class="err">，</span><span class="n">当被监视的对象发生情况时</span><span class="err">，</span><span class="n">立即采用相应的行动</span><span class="err">。</span>
<span class="n">监听器其实就是一个现实特定接口的普通JAVA程序</span><span class="err">，</span><span class="n">这个程序专门用于监听JAVA对象的方法调用或属性改变</span><span class="err">，</span>
<span class="n">当被监听对象发生上述事件后</span><span class="err">，</span><span class="n">监听器的某个方法立即被执行</span>

</code></pre></div></div><h4 id="web-中的监听器">web 中的监听器</h4><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">基本概念</span><span class="err">：</span>
     <span class="nc">JAVAWEB中的监听器是Servlet规范中定义的一种特殊类</span><span class="err">，</span>
     <span class="n">它用于监听WEB应用程序的ServletContext</span><span class="o">,</span><span class="nc">HttpSession和ServletRequest等域对象的创建和销毁事件</span><span class="err">，</span>
     <span class="n">以及监听这些域对象中的属性发生修改的事件</span>
</code></pre></div></div><h4 id="servlet-的监听器">servlet 的监听器</h4><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Servlet规范中定义了多种类型的监听器</span><span class="err">，</span><span class="n">它们用于监听事件源分别为ServletContext</span><span class="o">,</span> <span class="nc">HttpSession</span> <span class="o">,</span> <span class="nc">ServletRequest这个三个对象</span><span class="err">。</span>
<span class="nc">Servlet规范中针对这个三个对象上的操作</span><span class="err">，</span><span class="n">又把多种类型的监听器划分为三种类型</span><span class="err">。</span>
  <span class="mi">1</span><span class="err">）</span> <span class="n">监听绑定域对象创建和销毁事件的监听器</span>
  <span class="mi">2</span><span class="err">）</span> <span class="n">监听域对象中的属性的增加和删除事件监听器</span>
  <span class="mi">3</span><span class="err">）</span> <span class="n">监听绑定到HttpSession域中的某个对象的状态的事件监听器</span>
</code></pre></div></div><h4 id="监听器-api">监听器 API</h4><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">域对象中属性的变更的事件监听器就是用来监听ServletContext</span><span class="err">，</span><span class="nc">HttpSession</span><span class="err">，</span><span class="nc">HttpServletRequest这三个对象中的属性的变更信息事件的监听器</span>

<span class="n">这三个监听器的接口分别是</span> <span class="nc">ServletContextAttributeListener</span><span class="o">,</span><span class="nc">HttpSessionAttributeListener</span> <span class="n">和</span> <span class="nc">ServletRequestAttributeListener</span><span class="err">。</span><span class="n">这三个接口中都定义了三个方法来处理被监听对象中的属性的增加</span><span class="err">，</span><span class="n">删除和替换事件</span>
<span class="n">通一个事件在这三个接口中的对应方法名称完全相同</span><span class="err">，</span><span class="n">只是接受的参数类型不同</span><span class="err">。</span>
</code></pre></div></div><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span><span class="err">）</span><span class="n">attributeAddes方法</span>
     <span class="n">当向被监听对象中增加一个属性时</span><span class="err">，</span><span class="n">web容器就调用事件监听器的attributeAdded方法进行响应</span><span class="err">，</span><span class="n">这个方法接受一个事件类型的参数</span><span class="err">，</span>
     <span class="n">监听器可以通过这个参数来获得正在增加属性的域对象和被保存到域中的属性对象</span>
    <span class="n">各个域监听器中完整语法定义为</span><span class="err">：</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">attributeAdded</span><span class="o">(</span><span class="nc">ServletContextAttributeEvent</span> <span class="n">scae</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">attributeReplaced</span><span class="o">(</span><span class="nc">HttpSessionBindingEvent</span>  <span class="n">hsbe</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">attributeRmoved</span><span class="o">(</span><span class="nc">ServletRequestAttributeEvent</span> <span class="n">srae</span><span class="o">)</span>

<span class="mi">2</span><span class="err">）</span><span class="n">attributeRemoved方法</span>
   <span class="n">当删除被监听对象中的一个属性时</span><span class="err">，</span><span class="n">web容器调用事件监听器的attributeRemoved方法进行响应</span>
   <span class="n">各个域属性监听器中的完整语法定义为</span><span class="err">：</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">attributeRemoved</span><span class="o">(</span><span class="nc">ServletContextAttributeEvent</span> <span class="n">scae</span><span class="o">)</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">attributeRemoved</span> <span class="o">(</span><span class="nc">HttpSessionBindingEvent</span>  <span class="n">hsbe</span><span class="o">)</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">attributeRemoved</span> <span class="o">(</span><span class="nc">ServletRequestAttributeEvent</span> <span class="n">srae</span><span class="o">)</span>

<span class="mi">3</span><span class="err">）</span><span class="n">attributeReplaced</span> <span class="n">方法</span>
   <span class="n">当监听器的域对象中某个属性被替换时</span><span class="err">，</span><span class="n">web容器调用事件监听器的attributeReplaced方法进行响应</span>
   <span class="n">各个域属性监听器中的完整语法定义为</span><span class="err">：</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">attributeReplaced</span><span class="o">(</span><span class="nc">ServletContextAttributeEvent</span> <span class="n">scae</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">attributeReplaced</span> <span class="o">(</span><span class="nc">HttpSessionBindingEvent</span>  <span class="n">hsbe</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">attributeReplaced</span> <span class="o">(</span><span class="nc">ServletRequestAttributeEvent</span> <span class="n">srae</span><span class="o">)</span>
</code></pre></div></div><p>#####</p><h5 id="监听-servletcontext-域对象的创建和销毁">监听 ServletContext 域对象的创建和销毁</h5><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">ServletContextListener</span> <span class="n">接口用于监听ServletContext对象的创建和销毁事件</span><span class="err">，</span>
<span class="n">实现了ServletContextListener接口的类都可以对Servlet对象的穿件和销毁进行监听</span>
  <span class="n">当ServletContext对象被创建时</span><span class="err">，</span><span class="n">激发contextInitialized</span><span class="err">（</span><span class="nc">ServletContextEvent</span> <span class="n">sce</span><span class="err">）</span><span class="n">方法</span>
  <span class="n">当ServletContext对象被销毁时</span><span class="err">，</span><span class="n">激发contextDestoryed</span><span class="err">（</span><span class="nc">ServletContextEvent</span> <span class="n">sce</span><span class="err">）</span><span class="n">方法</span>

<span class="nc">ServletContext域对象创建和销毁时机</span><span class="err">：</span>
  <span class="n">创建</span><span class="err">：</span><span class="n">服务器启动针对每一个Web应用创建ServletContext</span><span class="o">;</span>
  <span class="n">销毁</span><span class="err">：</span><span class="n">服务器关闭前先关闭代表每一个web应用的ServletContext</span>

<span class="o">&lt;</span><span class="n">listener</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">description</span><span class="o">&gt;</span> <span class="nc">ServletContextListener监听器</span> <span class="o">&lt;/</span><span class="n">description</span><span class="o">&gt;</span>
          <span class="o">&lt;!--</span> <span class="n">实现ServletContextListener接口的监听器类</span> <span class="o">--&gt;</span>
       <span class="o">&lt;</span><span class="n">listener</span><span class="o">-</span><span class="kd">class</span> <span class="err">&gt;</span><span class="nc">com</span><span class="o">.</span><span class="na">listenter</span><span class="o">.</span><span class="na">ListenerDemo</span> <span class="o">&lt;/</span><span class="n">listener</span><span class="o">-</span><span class="kd">class</span><span class="err">&gt;</span>
 <span class="err">&lt;/</span><span class="nc">listener</span> <span class="o">&gt;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ListenerDemo</span> <span class="kd">implements</span> <span class="nc">ServletContextListener</span> <span class="o">{</span>

   <span class="nd">@Override</span> <span class="n">程序启动的时候就执法该方法</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">contextDestroyed</span><span class="o">(</span><span class="nc">ServletContextEvent</span> <span class="n">arg0</span><span class="o">)</span> <span class="o">{</span>
       <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Servlet APP  已经销毁=============="</span> <span class="o">);</span>
   <span class="o">}</span>

   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">contextInitialized</span><span class="o">(</span><span class="nc">ServletContextEvent</span> <span class="n">arg0</span><span class="o">)</span> <span class="o">{</span>
       <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Servlet APP  已经启动================"</span> <span class="o">);</span>
   <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div><p><strong>ServletContextAttributeListener 监听器范例</strong></p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
 <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doGet</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">resp</span><span class="o">)</span>
                      <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
              <span class="n">req</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">setAttribute</span><span class="o">(</span> <span class="s">"name"</span><span class="o">,</span> <span class="s">"ssgao"</span> <span class="o">);</span>
              <span class="n">req</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">setAttribute</span><span class="o">(</span> <span class="s">"name"</span><span class="o">,</span> <span class="s">"shuo ai lin"</span> <span class="o">);</span>
              <span class="n">req</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">removeAttribute</span><span class="o">(</span> <span class="s">"name"</span><span class="o">);</span>
       <span class="o">}</span>

<span class="nd">@WebListener</span><span class="o">(</span><span class="s">"ServletContextDemo"</span> <span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServletContextDemo</span> <span class="kd">implements</span> <span class="nc">ServletContextAttributeListener</span> <span class="o">{</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">attributeAdded</span><span class="o">(</span><span class="nc">ServletContextAttributeEvent</span> <span class="n">arg0</span><span class="o">)</span> <span class="o">{</span>

              <span class="nc">String</span> <span class="n">string</span> <span class="o">=</span> <span class="nc">MessageFormat</span><span class="o">.</span> <span class="nf">format</span><span class="o">(</span><span class="s">"ServletContext域对象中添加了属性：{0}，属性值是：{1}"</span> <span class="o">,</span> <span class="n">arg0</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span><span class="n">arg0</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
              <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">string</span><span class="o">);</span>
       <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">attributeRemoved</span><span class="o">(</span><span class="nc">ServletContextAttributeEvent</span> <span class="n">arg0</span><span class="o">)</span> <span class="o">{</span>
              <span class="nc">String</span> <span class="n">string</span> <span class="o">=</span> <span class="nc">MessageFormat</span><span class="o">.</span> <span class="nf">format</span><span class="o">(</span><span class="s">"ServletContext域对象中删除了属性：{0}，属性值是：{1}"</span> <span class="o">,</span> <span class="n">arg0</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span><span class="n">arg0</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
              <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">string</span><span class="o">);</span>

       <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">attributeReplaced</span><span class="o">(</span><span class="nc">ServletContextAttributeEvent</span> <span class="n">arg0</span><span class="o">)</span> <span class="o">{</span>
              <span class="nc">String</span> <span class="n">string</span> <span class="o">=</span> <span class="nc">MessageFormat</span><span class="o">.</span> <span class="nf">format</span><span class="o">(</span><span class="s">"ServletContext域对象中修改了属性：{0}，属性值是：{1}"</span> <span class="o">,</span> <span class="n">arg0</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span><span class="n">arg0</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
              <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">string</span><span class="o">);</span>

       <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div><p>#####</p><h5 id="监听-httpsession-域对象的创建和销毁">监听 HttpSession 域对象的创建和销毁</h5><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">HttpSessionListener接口用于监听HttpSession对象的创建和销毁</span>
<span class="n">创建一个Session时</span><span class="err">，</span><span class="n">激发sessionCreated</span><span class="o">(</span><span class="nc">HttpSessionEvent</span> <span class="n">se</span><span class="o">)</span><span class="n">方法</span>
<span class="n">销毁一个Session时</span><span class="err">，</span><span class="n">激发sessionDestoryed</span><span class="o">(</span><span class="nc">HttpSessionEvenet</span> <span class="n">se</span><span class="o">)</span>  <span class="n">方法</span>

<span class="nc">Session对象的创建</span><span class="err">，</span><span class="n">在服务器启动的时候并没有创建Session而是在调用页面</span><span class="err">，</span><span class="n">通过request</span><span class="o">.</span><span class="na">getSession</span><span class="err">（）</span><span class="n">才创建Session</span>

  <span class="o">&lt;</span><span class="n">listener</span> <span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">listener</span><span class="o">-</span><span class="kd">class</span> <span class="err">&gt;</span><span class="nc">com</span><span class="o">.</span><span class="na">listenter</span><span class="o">.</span><span class="na">SessionListener</span> <span class="o">&lt;/</span><span class="n">listener</span><span class="o">-</span><span class="kd">class</span><span class="err">&gt;</span>
  <span class="err">&lt;/</span><span class="nc">listener</span> <span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">session</span><span class="o">-</span><span class="n">config</span> <span class="o">&gt;</span>
        <span class="n">设置过时时间为1分钟</span>
       <span class="o">&lt;</span><span class="n">session</span><span class="o">-</span><span class="n">timeout</span> <span class="o">&gt;</span><span class="mi">1</span> <span class="o">&lt;/</span><span class="n">session</span><span class="o">-</span><span class="n">timeout</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">session</span><span class="o">-</span><span class="n">config</span> <span class="o">&gt;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SessionListener</span> <span class="kd">implements</span> <span class="nc">HttpSessionListener</span> <span class="o">{</span>

        <span class="nd">@Override</span>
         <span class="n">一般在访问页面时才创建session</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sessionCreated</span><span class="o">(</span><span class="nc">HttpSessionEvent</span> <span class="n">arg0</span><span class="o">)</span> <span class="o">{</span>
              <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Servlet SESSION  已经启动=============="</span> <span class="o">);</span>
       <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sessionDestroyed</span><span class="o">(</span><span class="nc">HttpSessionEvent</span> <span class="n">arg0</span><span class="o">)</span> <span class="o">{</span>
              <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Servlet SESSION  已经销毁=================="</span> <span class="o">);</span>
       <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div><h5 id="监听-serveltrequest-对象的创建和销毁">监听 ServeltRequest 对象的创建和销毁</h5><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Request对象被创建时</span><span class="err">，</span><span class="n">监听器的requestInitialized</span><span class="err">（</span><span class="nc">ServletRequestEvent</span> <span class="n">sre</span><span class="err">）</span><span class="n">方法将被被调用</span>
<span class="nc">Request对象呗销毁时</span><span class="err">，</span><span class="n">监听器的requestDestoryed</span><span class="err">（</span><span class="nc">ServeltRequestEvent</span> <span class="n">sre</span><span class="err">）</span><span class="n">方法将被调用</span>

<span class="nc">ServletRequest域对象创建和销毁时机</span>
<span class="n">创建</span><span class="err">：</span><span class="n">用于每一次访问都会创建request对象</span> <span class="o">(</span><span class="n">每一次请求页面时</span><span class="o">)</span>
<span class="n">销毁</span><span class="err">：</span><span class="n">当前访问结束</span><span class="err">，</span><span class="n">request对象就会销毁</span><span class="err">（</span><span class="n">一般是页面打开完成后</span><span class="err">）</span>

 <span class="o">&lt;</span><span class="n">listener</span> <span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">listener</span><span class="o">-</span><span class="kd">class</span> <span class="err">&gt;</span><span class="nc">com</span><span class="o">.</span><span class="na">listenter</span><span class="o">.</span><span class="na">RequestListener</span> <span class="o">&lt;/</span><span class="n">listener</span><span class="o">-</span><span class="kd">class</span><span class="err">&gt;</span>
 <span class="err">&lt;/</span><span class="nc">listener</span> <span class="o">&gt;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RequestListener</span> <span class="kd">implements</span> <span class="nc">ServletRequestListener</span> <span class="o">{</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">requestDestroyed</span><span class="o">(</span><span class="nc">ServletRequestEvent</span> <span class="n">arg0</span><span class="o">)</span> <span class="o">{</span>
               <span class="c1">// TODO Auto-generated method stub</span>
              <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">arg0</span><span class="o">.</span><span class="na">getServletRequest</span><span class="o">()+</span><span class="s">"destory"</span> <span class="o">);</span>
       <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">requestInitialized</span><span class="o">(</span><span class="nc">ServletRequestEvent</span> <span class="n">arg0</span><span class="o">)</span> <span class="o">{</span>
               <span class="c1">// TODO Auto-generated method stub</span>
              <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">arg0</span><span class="o">.</span><span class="na">getServletRequest</span><span class="o">()+</span><span class="s">"init"</span> <span class="o">);</span>
       <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p><strong>ServletRequestAttributeListener 和 HttpSessionAttributeListener 监听器范例</strong>​</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doGet</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">resp</span><span class="o">)</span>
                      <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>


              <span class="n">req</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span> <span class="s">"name"</span><span class="o">,</span> <span class="s">"ssgao"</span> <span class="o">);</span>
              <span class="n">req</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">setAttribute</span><span class="o">(</span> <span class="s">"name"</span><span class="o">,</span> <span class="s">"ssgao"</span> <span class="o">);</span>

              <span class="n">req</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span> <span class="s">"name"</span><span class="o">,</span> <span class="s">"lin"</span> <span class="o">);</span>
              <span class="n">req</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">setAttribute</span><span class="o">(</span> <span class="s">"name"</span><span class="o">,</span> <span class="s">"lin"</span> <span class="o">);</span>

              <span class="n">req</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span> <span class="s">"name"</span><span class="o">);</span>
              <span class="n">req</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">removeAttribute</span><span class="o">(</span> <span class="s">"name"</span><span class="o">);</span>
       <span class="o">}</span>


<span class="nd">@WebListener</span><span class="o">(</span><span class="s">"AttribueDemo"</span> <span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AttributeDemo</span> <span class="kd">implements</span> <span class="nc">ServletRequestAttributeListener</span><span class="o">,</span>
              <span class="nc">HttpSessionAttributeListener</span> <span class="o">{</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">attributeAdded</span><span class="o">(</span><span class="nc">HttpSessionBindingEvent</span> <span class="n">arg0</span><span class="o">)</span> <span class="o">{</span>
              <span class="nc">String</span> <span class="n">str</span> <span class="o">=</span><span class="nc">MessageFormat</span><span class="o">.</span> <span class="nf">format</span><span class="o">(</span><span class="s">"Session域对象中添加了属性:{0}，属性值是:{1}"</span> <span class="o">,</span><span class="n">arg0</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span><span class="n">arg0</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
              <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
       <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">attributeRemoved</span><span class="o">(</span><span class="nc">HttpSessionBindingEvent</span> <span class="n">arg0</span><span class="o">)</span> <span class="o">{</span>
              <span class="nc">String</span> <span class="n">str</span> <span class="o">=</span><span class="nc">MessageFormat</span><span class="o">.</span> <span class="nf">format</span><span class="o">(</span><span class="s">"Session域对象中删除了属性:{0}，属性值是:{1}"</span> <span class="o">,</span><span class="n">arg0</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span><span class="n">arg0</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
              <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
       <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">attributeReplaced</span><span class="o">(</span><span class="nc">HttpSessionBindingEvent</span> <span class="n">arg0</span><span class="o">)</span> <span class="o">{</span>
              <span class="nc">String</span> <span class="n">str</span> <span class="o">=</span><span class="nc">MessageFormat</span><span class="o">.</span> <span class="nf">format</span><span class="o">(</span><span class="s">"Session域对象中修改了属性:{0}，属性值是:{1}"</span> <span class="o">,</span><span class="n">arg0</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span><span class="n">arg0</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
              <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
       <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">attributeAdded</span><span class="o">(</span><span class="nc">ServletRequestAttributeEvent</span> <span class="n">arg0</span><span class="o">)</span> <span class="o">{</span>
              <span class="nc">String</span> <span class="n">str</span> <span class="o">=</span><span class="nc">MessageFormat</span><span class="o">.</span> <span class="nf">format</span><span class="o">(</span><span class="s">"Request域对象中添加了属性:{0}，属性值是:{1}"</span> <span class="o">,</span><span class="n">arg0</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span><span class="n">arg0</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
              <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
       <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">attributeRemoved</span><span class="o">(</span><span class="nc">ServletRequestAttributeEvent</span> <span class="n">arg0</span><span class="o">)</span> <span class="o">{</span>
              <span class="nc">String</span> <span class="n">str</span> <span class="o">=</span><span class="nc">MessageFormat</span><span class="o">.</span> <span class="nf">format</span><span class="o">(</span><span class="s">"Request域对象中删除了属性:{0}，属性值是:{1}"</span> <span class="o">,</span><span class="n">arg0</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span><span class="n">arg0</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
              <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
       <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">attributeReplaced</span><span class="o">(</span><span class="nc">ServletRequestAttributeEvent</span> <span class="n">arg0</span><span class="o">)</span> <span class="o">{</span>
              <span class="nc">String</span> <span class="n">str</span> <span class="o">=</span><span class="nc">MessageFormat</span><span class="o">.</span> <span class="nf">format</span><span class="o">(</span><span class="s">"Request域对象中修改了属性:{0}，属性值是:{1}"</span> <span class="o">,</span><span class="n">arg0</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span><span class="n">arg0</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
              <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
       <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div><p>​</p><h4 id="监听器的注解">监听器的注解</h4><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Servlet3</span><span class="o">.</span><span class="mi">0</span><span class="n">下的监听器的用法</span>

<span class="nd">@WebListener</span>
<span class="n">该注解将类声明为监听器</span><span class="err">，</span><span class="n">被</span><span class="nd">@WebListener标注的类必须实现以下至少一个接口</span>
<span class="nc">ServletContextListener</span>
<span class="nc">ServletContextAttributeListener</span>

<span class="nc">HttpSessionListener</span>
<span class="nc">HttpSessionAttributeListener</span>

<span class="nc">ServletRequestListener</span>
<span class="nc">ServletRequestAttributeListener</span>
</code></pre></div></div><p><strong><em>@WebListener 的常用属性</em></strong>​ <img src="https://cdn.nlark.com/yuque/0/2021/png/659846/1635732185789-3b50c221-5c15-48eb-872c-edc4f1481d13.png#clientId=ua71ffd24-cc51-4&amp;from=paste&amp;height=69&amp;id=u71d8aa7f&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=68&amp;originWidth=695&amp;originalType=binary&amp;ratio=1&amp;size=6825&amp;status=done&amp;style=none&amp;taskId=u7c2fe39e-7261-45ba-9e53-ce32d30f273&amp;width=703.5" alt="image.png" /></p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@WebListener</span><span class="o">(</span><span class="s">"ServletContext"</span> <span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ListenerDemo</span> <span class="kd">implements</span> <span class="nc">ServletContextListener</span> <span class="o">{</span> <span class="o">.....</span> <span class="o">}</span>

<span class="nd">@WebListener</span><span class="o">(</span><span class="s">"Session"</span> <span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SessionListener</span> <span class="kd">implements</span> <span class="nc">HttpSessionListener</span> <span class="o">{</span> <span class="o">....</span> <span class="o">}</span>

<span class="nd">@WebListener</span><span class="o">(</span><span class="s">"Request"</span> <span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RequestListener</span> <span class="kd">implements</span> <span class="nc">ServletRequestListener</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
</code></pre></div></div><h4 id="监听器的启动顺序">监听器的启动顺序</h4><p><img src="https://cdn.nlark.com/yuque/0/2021/png/659846/1635732319614-8d285c6b-fc32-4a5d-854b-4e4752e56553.png#clientId=ua71ffd24-cc51-4&amp;from=paste&amp;height=317&amp;id=u5d6c3b54&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=640&amp;originWidth=1256&amp;originalType=binary&amp;ratio=1&amp;size=578874&amp;status=done&amp;style=none&amp;taskId=ufd62f52c-b7d3-45b2-994b-55519d05d2e&amp;width=622" alt="image.png" /></p><h4 id="特殊的-session-监听器">特殊的 session 监听器</h4><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">保存在Session域中的对象可以有多种状态</span><span class="err">：</span>
   <span class="n">绑定</span><span class="err">（</span><span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"bean"</span><span class="o">.</span><span class="na">Object</span><span class="o">)</span><span class="err">）</span><span class="n">到Session中</span><span class="err">，</span><span class="n">从Session域中结束Session</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span><span class="s">"bean"</span><span class="o">)</span><span class="n">绑定</span>
   <span class="n">随Session对象持久化到一个存储设备中</span><span class="err">；</span><span class="n">随Session对象从一个存储设备中恢复</span>
 <span class="nc">Servlet规范中定义了两个特殊的监听器接口</span>
   <span class="nc">HttpSessionBindingListener</span> <span class="n">和</span>  <span class="nc">HttpSessionActivationListener来帮组JavaBean对象了解自己在Session域中的这些状态</span>
   		<span class="n">实现两个接口的类不需要在web</span><span class="o">.</span><span class="na">xml文件中进行注册</span>

</code></pre></div></div><h5 id="httpsessionbindinglistener-接口">HttpSessionBindingListener 接口</h5><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">实现了httpSessionBindingListener接口的JavaBean对象可以感知自己被绑定到Session中和Session中删除的事件</span>

<span class="mi">1</span><span class="err">）</span><span class="n">当对象被绑定到HttpSession对象中时</span>
	<span class="n">web服务器调用该对象的</span> <span class="kt">void</span> <span class="nf">valueBound</span><span class="o">(</span><span class="nc">HttpSessionBindingEvent</span> <span class="n">event</span><span class="o">)</span><span class="n">方法</span>
<span class="mi">2</span><span class="err">）</span><span class="n">当对象从HttpSession对象中解除绑定时</span>
	<span class="n">web服务器调用该对象的</span> <span class="kt">void</span> <span class="nf">valueUnbound</span><span class="o">(</span><span class="nc">HttpSessionBindingEvent</span> <span class="n">event</span><span class="o">)</span><span class="n">方法</span>

</code></pre></div></div><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BindSession</span> <span class="kd">implements</span> <span class="nc">HttpSessionBindingListener</span><span class="o">{</span>
       <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span> <span class="o">;</span>

       <span class="kd">public</span> <span class="nf">BindSession</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">){</span>
               <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
       <span class="o">}</span>
       <span class="nd">@Override</span>
       <span class="kd">public</span> <span class="kt">void</span> <span class="nf">valueBound</span><span class="o">(</span><span class="nc">HttpSessionBindingEvent</span> <span class="n">arg0</span><span class="o">)</span> <span class="o">{</span>
              <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"name="</span> <span class="o">+</span><span class="n">name</span> <span class="o">+</span><span class="s">",被添加到Session中"</span> <span class="o">);</span>
       <span class="o">}</span>
       <span class="nd">@Override</span>
       <span class="kd">public</span> <span class="kt">void</span> <span class="nf">valueUnbound</span><span class="o">(</span><span class="nc">HttpSessionBindingEvent</span> <span class="n">arg0</span><span class="o">)</span> <span class="o">{</span>
              <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"name="</span> <span class="o">+</span><span class="n">name</span> <span class="o">+</span><span class="s">",被从Session中移出"</span> <span class="o">);</span>
       <span class="o">}</span>
<span class="o">}</span>

 <span class="nd">@Override</span>
 <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doGet</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">resp</span><span class="o">)</span>
                      <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
     <span class="n">req</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">setAttribute</span><span class="o">(</span> <span class="s">"name"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">BindSession</span><span class="o">(</span> <span class="s">"ssgao"</span><span class="o">));</span>
     		<span class="c1">//name=ssgao,被添加到Session中</span>
     <span class="n">req</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">removeAttribute</span><span class="o">(</span> <span class="s">"name"</span><span class="o">);</span>
     		<span class="c1">//name=ssgao,被从Session中移出</span>

<span class="o">}</span>
</code></pre></div></div><p>​</p><h5 id="httpsessionactivationlistener-接口">HttpSessionActivationListener 接口</h5><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
      实现了HttpSessionActivationListener接口的 JavaBean 对象可以感知自己被活化和钝化的事件
      活化: javabean对象和Session一起被反序列化(活化)到内存中。
     钝化: javabean对象存在Session中，当服务器把session序列化到硬盘上时，如果Session中的 javabean对象实现了Serializable接口
     那么服务器会把session中的 javabean对象一起序列化到硬盘上， javabean对象和Session一起被序列化到硬盘中的这个操作称之为钝化
     如果Session中的 javabean对象没有实现 Serializable接口，那么服务器会先把Session中没有实现 Serializable接口的javabean对象移除
     然后再把Session序列化(钝化)到硬盘中
     当绑定到 HttpSession对象中的 javabean对象将要随 HttpSession对象被钝化之前，
     web服务器调用该 javabean对象对象的 void sessionWillPassivate(HttpSessionEvent event)方法
     这样 javabean对象就可以知道自己将要和 HttpSession对象一起被序列化(钝化)到硬盘中
     当绑定到HttpSession对象中的 javabean对象将要随 HttpSession对象被活化之后，
     web服务器调用该 javabean对象的 void sessionDidActive(HttpSessionEvent event)方法
     这样 javabean对象就可以知道自己将要和 HttpSession对象一起被反序列化(活化)回到内存中
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JavaBeanDemo02</span> <span class="kd">implements</span> <span class="nc">HttpSessionActivationListener</span><span class="o">,</span> <span class="nc">Serializable</span> <span class="o">{</span>

   <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">123456L</span><span class="o">;</span>
   <span class="kd">private</span> <span class="nc">String</span> <span class="n">nameString</span> <span class="o">;</span>
   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sessionDidActivate</span><span class="o">(</span><span class="nc">HttpSessionEvent</span> <span class="n">arg0</span><span class="o">)</span> <span class="o">{</span>
       <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">nameString</span> <span class="o">+</span><span class="s">"和session一起从硬盘反序列化(活化)回到内存了，session的id是："</span> <span class="o">+</span><span class="n">arg0</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getId</span><span class="o">());</span>
   <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sessionWillPassivate</span><span class="o">(</span><span class="nc">HttpSessionEvent</span> <span class="n">arg0</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">nameString</span> <span class="o">+</span><span class="s">"和session一起被序列化(钝化)到硬盘了，session的id是："</span> <span class="o">+</span><span class="n">arg0</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getId</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getNameString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">nameString</span> <span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setNameString</span><span class="o">(</span><span class="nc">String</span> <span class="n">nameString</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">nameString</span> <span class="o">=</span> <span class="n">nameString</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">JavaBeanDemo02</span><span class="o">(</span><span class="nc">String</span> <span class="n">nameString</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">nameString</span> <span class="o">=</span> <span class="n">nameString</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div><p>​</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">为了观察绑定到HttpSession对象中的javabean对象</span><span class="err">，</span><span class="n">随HttpSession对象一起被钝化到硬盘上和从硬盘上重新活化到内存中的过程</span><span class="err">，</span><span class="n">我们需要借助tomcat服务器帮组我们完成HttpSession对象的钝化和活化过程</span>
<span class="n">做法</span><span class="err">：</span>
     <span class="mi">1</span><span class="err">）</span><span class="n">在WebRoot</span><span class="err">\</span><span class="no">META</span><span class="o">-</span><span class="nc">INF文件夹下</span><span class="err">，</span><span class="n">创建一个context</span><span class="o">.</span><span class="na">xml文件</span>
     <span class="mi">2</span><span class="err">）</span><span class="n">内容</span><span class="err">：</span>
          <span class="o">&lt;?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span> <span class="s">"1.0"</span> <span class="n">encoding</span> <span class="o">=</span><span class="s">"UTF-8"</span><span class="o">?&gt;</span>
<span class="o">&lt;</span><span class="nc">Context</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nc">Manager</span> <span class="n">className</span><span class="o">=</span><span class="s">"org.apache.catalina.session.PersistentManager"</span> <span class="n">maxIdleSwap</span><span class="o">=</span><span class="s">"1"</span> <span class="o">&gt;</span>
               <span class="o">&lt;</span><span class="nc">Store</span> <span class="n">className</span><span class="o">=</span><span class="s">"org.apache.catalina.session.FileStore"</span> <span class="n">directory</span><span class="o">=</span><span class="s">"ssgao"</span> <span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="nc">Manager</span> <span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="nc">Context</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="nc">Context</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nc">Manager</span> <span class="n">className</span><span class="o">=</span><span class="s">"org.apache.catalina.session.PersistentManager"</span>
    		<span class="n">maxIdleSwap</span><span class="o">=</span><span class="s">"1"</span><span class="o">[</span><span class="n">如果session在1分钟内没有使用</span><span class="err">，</span><span class="n">那么Tomcat就会钝化它</span><span class="o">]&gt;</span>
        <span class="o">&lt;</span><span class="nc">Store</span> <span class="n">className</span><span class="o">=</span><span class="s">"org.apache.catalina.session.FileStore"</span> <span class="n">directory</span><span class="o">=</span><span class="s">"mysession"</span><span class="o">[</span><span class="n">把session序列化到Tomcat</span><span class="err">\</span><span class="n">work</span><span class="err">\</span><span class="nc">Catalina</span><span class="err">\</span><span class="n">localhost</span><span class="err">\</span><span class="n">listener</span><span class="err">\</span><span class="n">mysession目录下</span><span class="err">。</span><span class="o">]/&gt;</span>
    <span class="o">&lt;/</span><span class="nc">Manager</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="nc">Context</span><span class="o">&gt;</span>
</code></pre></div></div><p>​</p><p>​</p><p>​</p><div style="margin-top:2em;padding:0 1.5em;border:1px solid #d3d3d3;background-color:#deebf7"><h3>文档信息</h3><ul><li>本文作者：<a href="http://localhost:4000" target="_blank">ssgao</a></li><li>本文链接：<a href="http://localhost:4000/2014/11/19/WEB%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" target="_blank">http://localhost:4000/2014/11/19/WEB%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/</a></li><li>版权声明：自由转载-非商用-非衍生-保持署名（<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">创意共享3.0许可证</a>）</li></ul></div></article><div class="share"></div><div class="comment"><div id="gitalk-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/aouoxx/aouoxx.github.io@master/assets/vendor/gitalk/gitalk.css"> <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> <script> var gitalk = new Gitalk({ id: '/2014/11/19/WEB%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%8', clientID: 'd2e1cbbd298958076462', clientSecret: 'b42a4178e5fd4a7cf63189ef4b1453b05c375709', repo: 'blog-comments', owner: 'mzlogin', admin: ['mzlogin'], labels: ['gitment'], perPage: 50, }); gitalk.render('gitalk-container'); </script></div></div><div class="column one-fourth"><h3>Search</h3><div id="site_search"> <input style="width:96%" type="text" id="search_box" placeholder="Search"></div><ul id="search_results" style="font-size:14px;list-style-type:none;padding-top:10px;padding-left:10px;"></ul><script src="https://cdn.jsdelivr.net/gh/aouoxx/aouoxx.github.io@master/assets/js/simple-jekyll-search.min.js"></script> <script type="text/javascript"> SimpleJekyllSearch({ searchInput: document.getElementById('search_box'), resultsContainer: document.getElementById('search_results'), json: 'http://localhost:4000/assets/search_data.json?v=1636615429', searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', noResultsText: 'No results found', limit: 10, fuzzy: false, exclude: ['Welcome'] }) </script><h3 class="post-directory-title mobile-hidden">Table of Contents</h3><div id="post-directory-module" class="mobile-hidden"><section class="post-directory"><dl></dl></section></div><script src="https://cdn.jsdelivr.net/gh/aouoxx/aouoxx.github.io@master/assets/js/jquery.toc.js"></script></div></div></section><style> .videoWrapper { position: relative; padding-bottom: 56.333%; height: 0; background: black; } .videoWrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; }</style><script> function get_youtube_id(url) { var p = /^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/; return (url.match(p)) ? RegExp.$1 : false; } function vimeo_embed(url,el) { var id = false; $.ajax({ url: 'https://vimeo.com/api/oembed.json?url='+url, async: true, success: function(response) { if(response.video_id) { id = response.video_id; if(url.indexOf('autoplay=1') !== -1) var autoplay=1; else var autoplay=0; if(url.indexOf('loop=1') !== -1) var loop=1; else var loop=0; var theInnerHTML = '<div class="videoWrapper"><iframe src="https://player.vimeo.com/video/'+id+'/?byline=0&title=0&portrait=0'; if(autoplay==1) theInnerHTML += '&autoplay=1'; if(loop==1) theInnerHTML += '&loop=1'; theInnerHTML += '" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div>'; el.innerHTML = theInnerHTML; } } }); } function video_embed() { var p = document.getElementsByTagName('p'); for(var i = 0; i < p.length; i++) { //check if this is an external url (that starts with https:// or http:// if (p[i].innerHTML.indexOf("http://") == 0 || p[i].innerHTML.indexOf("https://") == 0) { var youtube_id = get_youtube_id(p[i].innerHTML); if(youtube_id) { if(p[i].innerHTML.indexOf('autoplay=1') !== -1) var autoplay=1; else var autoplay=0; if(p[i].innerHTML.indexOf('loop=1') !== -1) var loop=1; else var loop=0; var theInnerHTML = '<div class="videoWrapper"><iframe width="720" height="420" src="https://www.youtube.com/embed/' + youtube_id + '?rel=0&showinfo=0'; if(autoplay==1) theInnerHTML += '&autoplay=1'; if(loop==1) theInnerHTML += '&loop=1&playlist='+youtube_id+'&version=3'; if(p[i].innerHTML.indexOf('start=') !== -1) theInnerHTML += '&start='+p[i].innerHTML.substring(p[i].innerHTML.indexOf('start=')+6); theInnerHTML += '" frameborder="0" allowfullscreen></iframe></div>'; p[i].innerHTML = theInnerHTML; } if(p[i].innerHTML.indexOf('vimeo.com') !== -1) { //ask vimeo for the id and place the embed vimeo_embed(p[i].innerHTML,p[i]); } } } } video_embed(); function mp3_embed() { var p = document.getElementsByTagName('p'); for(var i = 0; i < p.length; i++) { if(p[i].innerHTML.indexOf('.mp3') !== -1) { var str = p[i].innerHTML.split('?'); if(str.length == 1) str[1] = ''; var str1 = str[1]; str1 = str1.replace('&','').replace('&',''); str1 = str1.replace('autoplay=1','').replace('autoplay=0',''); str1 = str1.replace('loop=1','').replace('loop=0',''); str1 = str1.replace('controls=0','').replace('controls=1',''); if (str[0].lastIndexOf('.mp3', str[0].length - 4) === str[0].length - 4 && str1.length == 0) { if(str[1].indexOf('autoplay=1') !== -1) var autoplay=1; else var autoplay=0; if(str[1].indexOf('loop=1') !== -1) var loop=1; else var loop=0; if(str[1].indexOf('controls=0') !== -1) var controls=0; else var controls=1; var newInnerHTML = '<audio'; if(autoplay==1) newInnerHTML += ' autoplay'; if(loop==1) newInnerHTML += ' loop'; if(controls==1) newInnerHTML += ' controls'; newInnerHTML += '><source src="'+str[0]+'" type="audio/mpeg">Your browser does not support the audio element.</audio>'; p[i].innerHTML = newInnerHTML; } } } } mp3_embed(); </script><footer class="container"><div class="site-footer" role="contentinfo"><div class="copyright left mobile-block"> © 2015 <span title="ssgao">ssgao</span> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a></div><ul class="site-footer-links right mobile-hidden"><li> <a href="javascript:window.scrollTo(0,0)" >TOP</a></li></ul><a href="https://github.com/aouoxx/aouoxx.github.io" target="_blank" aria-label="view source code"> <span class="mega-octicon octicon-mark-github" title="GitHub"></span> </a><ul class="site-footer-links mobile-hidden"><li> <a href="http://localhost:4000/" title="首页" target="">首页</a></li><li> <a href="http://localhost:4000/categories/" title="分类" target="">分类</a></li><li> <a href="http://localhost:4000/links/" title="链接" target="">链接</a></li><li> <a href="http://localhost:4000/about/" title="关于" target="">关于</a></li><li><a href="http://localhost:4000/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li></ul></div></footer><div class="tools-wrapper"> <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a></div><script src="https://cdn.jsdelivr.net/gh/aouoxx/aouoxx.github.io@master/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script><div style="display:none"> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-80669434-1', 'auto'); ga('send', 'pageview'); </script></div></body></html>
