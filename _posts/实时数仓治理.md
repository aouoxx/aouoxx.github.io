### 实时数据体系建设的难点

​

- 实时数仓建设过程中由于其数据处理任务的常驻性，使得其在建设过程中和离线任务在设计思路上还是有些不同。实时数仓建设应该尽量的合并计算单元，降低拓扑层次，一方面减少资源的使用，另一方面过多的分层会导致数据的延迟加大降低了数据的可用性。
- 实时数仓在数据加工和离线数据还是有本质的不同，离线数据的有界性，使其在周期性调度处理数据时容易被理解和操作。而实时数仓在关联和加工复合型指标的场景下, 需要对其时间线，随着无界数据的持续输入，数据状态始终在发生变化，明细数据量大, 则 OLAP 引擎压力加大；聚合粒度高，则由于无界数据完整性带来的数据误差会加大。故需要根据实际情况在 flink 聚合与 OLAP 引擎聚合之间找到平衡点。
- 在精确性上差异，离线数据可以保证绝对的准确性，实时数据在去重指标上，会采用相关算法进行估算，理论上存在一定误差，需要管理预期。

​

### 实时数仓目前现状

由于我们电商团队实时数仓团队需求太多导致我们被迫紧赶需求，并没有太多对我们实时资产进行沉淀。导致我们出现下面一些问题。
**1 开发复杂,代码无法复用**
简单的例子, 如下在我们开发实时任务是经常出现重复定义 DDL,并且还容易导致我们复杂修改出错。
![image.png](https://cdn.nlark.com/yuque/0/2022/png/659846/1646104078272-59908850-3480-4c78-9653-1b6cb9e52d8e.png#clientId=ue406156c-45d4-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=309&id=ua0e3027b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=2324&originWidth=5204&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2214240&status=done&style=none&taskId=u03bf3ef1-a3ed-451a-bbdf-50a4691bc55&title=&width=692)

我们如上面的例子我们很难完成数据内容的复用，频繁的定义 DDL，有时可很可能出现由于 DDL 的拷贝，或实际内容的裁剪导致我们很难进行统一管理某个流表具体的使用内容，为后续数据的治理和变更，埋下一个地雷。
​

**2 运维复杂**
我们比较难知道某个数据的上下游链路。并且我们也能知道我们对某一数据的变更会影响我们下游哪些任务和业务。
​

**3 数据价值无法描述**
我们目前无法知道我们实时数仓哪些资产是核心，或是只能知道业务方确切使用的一些指标，但对这些指标构建流程不清楚。也无法量化我们当前实时数仓的表热度，从而无法明确我们实时数仓建设的好坏
​

### 实时数据内容建设收益

​

- 成体系构建实时数仓内容，明确我们目前有哪些资产，以及我们核心资产是什么。
- 业务方能够快速检索我们的资产内容，能够在我们的资产的基础上做简单灵活的资产重组和优化。
- 标准化管理我们资产内容，保障我们资产的稳定性，及时性。
- 实时数据内容建设也便于后续推动 流-湖-仓的一体化进程。

​

​

### 迭代式的推进开发方案

​

#### 实时资产的落地方式

![image.png](https://cdn.nlark.com/yuque/0/2022/png/659846/1646308498121-09bca05e-3a6b-43a0-84e5-b6191cc30e15.png#clientId=u2209659b-13d6-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=446&id=ucdf47437&margin=%5Bobject%20Object%5D&name=image.png&originHeight=892&originWidth=2356&originalType=binary&ratio=1&rotation=0&showTitle=false&size=154072&status=done&style=none&taskId=u92344136-749a-41e8-88a3-643f588f344&title=&width=1178)
​

​

​

#### 可能遇到的问题和解法

** ods 层**

1. 业务方为了敏捷开发和快速交付 可能存在多个相同数据的 topic, 导致数仓 ods 层表过多冗余的问题 2) ods 层数据纵表的问题 - 先搁置争议 3) ods 数据质量管理- 实时数据 DQC 包括数据量监控 + 数据合规 + 枚举值 + 空置判断 + CEP 自定义的规则 4) ods 层的数据分发 ---> 所有的 binlog 接入到同一个 topic 然后由 tag 进行分发
   如果没有分发机制 会导致 某个 topic 的压力增加---形成 IO 的瓶颈

​

​

​

​

```
实时基础层的建设要解决一些问题。首先是一条流重复读的问题, 一条Binlog打过来, 是以DB包的形式存在的，用户可能只用其中一张表，如果大家都要用，可能存在所有人都要接这个流的问题。
解决方案是可以按照不同的业务解构出来，还原到基础数据流层，根据业务需要做成范式结构，按照数仓的建模方式进行集成化的主题建设。
```

​

​

​

​

​

![image.png](https://cdn.nlark.com/yuque/0/2022/png/659846/1646305366165-6e0492f5-b1a4-42e5-a172-b0f9522ca6bd.png#clientId=u2209659b-13d6-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=119&id=u8927bcc4&margin=%5Bobject%20Object%5D&name=image.png&originHeight=238&originWidth=1290&originalType=binary&ratio=1&rotation=0&showTitle=false&size=44522&status=done&style=none&taskId=u875d73ce-70fd-4392-ac6c-4782b799167&title=&width=645)

![image.png](https://cdn.nlark.com/yuque/0/2022/png/659846/1646308249541-f7bda643-be91-4fd6-b8ae-770c04839ee9.png#clientId=u2209659b-13d6-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=339&id=u6b32468d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=678&originWidth=1250&originalType=binary&ratio=1&rotation=0&showTitle=false&size=92865&status=done&style=none&taskId=uf31d1743-49af-41f8-822c-10d820281a2&title=&width=625)
